<!-- This file provides the custom header for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.20"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
        PKCS11: C_FindObjects
    </title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="foobar.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
    <tbody>
        <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">
                    <span id="afrprefix">FreeRTOS:</span>
                    PKCS11
                </div>
                <div id="projectbrief">
                    PKCS11 Cryptoki Library
                </div>
            </td>
        </tr>
        <tr>
            <td id="returntomain">
                <a href="../main/index.html">Return to main page &uarr;</a>
            </td>
        </tr>
    </tbody>
    </table>
    </div>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<!-- end header part --><!-- Generated by Doxygen 1.8.20 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pkcs11_mbedtls_function_c_findobjects.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">C_FindObjects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Initializes an object search operation.</p>
<div class="fragment"><div class="line"><a class="code" href="iot__pkcs11_8h.html#a30315d302108bcfb354196f37b16a492">CK_DECLARE_FUNCTION</a>( CK_RV, <a class="code" href="iot__pkcs11__mbedtls_8c.html#a42635cbaa2ba78482ae053bea477246a">C_FindObjects</a> )( CK_SESSION_HANDLE hSession,</div>
<div class="line">                                             CK_OBJECT_HANDLE_PTR phObject,</div>
<div class="line">                                             CK_ULONG ulMaxObjectCount,</div>
<div class="line">                                             CK_ULONG_PTR pulObjectCount )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="struct_p11_session__t.html">P11Session_t</a> * pxSession = <a class="code" href="iot__pkcs11__mbedtls_8c.html#a8a3079aa3ce5d51bb787a3e661714ef0">prvSessionPointerFromHandle</a>( hSession );</div>
<div class="line">    CK_RV xResult = <a class="code" href="iot__pkcs11__mbedtls_8c.html#ab93c9263b9b89774e57eee9e8ac708a8">prvCheckValidSessionAndModule</a>( pxSession );</div>
<div class="line"> </div>
<div class="line">    CK_BYTE_PTR pucObjectValue = NULL;</div>
<div class="line">    CK_ULONG xObjectLength = 0;</div>
<div class="line">    <span class="comment">/* See explanation in prvCheckValidSessionAndModule for this exception. */</span></div>
<div class="line">    <span class="comment">/* coverity[misra_c_2012_rule_10_5_violation] */</span></div>
<div class="line">    CK_BBOOL xIsPrivate = ( CK_BBOOL ) CK_TRUE;</div>
<div class="line">    CK_BYTE xByte = 0;</div>
<div class="line">    CK_OBJECT_HANDLE xPalHandle = CK_INVALID_HANDLE;</div>
<div class="line">    CK_ULONG ulIndex;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Check parameters.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">if</span>( ( NULL == phObject ) ||</div>
<div class="line">        ( NULL == pulObjectCount ) )</div>
<div class="line">    {</div>
<div class="line">        xResult = CKR_ARGUMENTS_BAD;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( xResult == CKR_OK )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>( pxSession-&gt;<a class="code" href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">pxFindObjectLabel</a> == NULL )</div>
<div class="line">        {</div>
<div class="line">            xResult = CKR_OPERATION_NOT_INITIALIZED;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>( 1u != ulMaxObjectCount )</div>
<div class="line">        {</div>
<div class="line">            xResult = CKR_ARGUMENTS_BAD;</div>
<div class="line">            <a class="code" href="iot__pkcs11__mbedtls_8c.html#a4634eeeeb6af38ed06cd4d4af1fc806c">PKCS11_WARNING_PRINT</a>( ( <span class="stringliteral">&quot;WARN: Searching for anything other than 1 object not supported. \r\n&quot;</span> ) );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( xResult == CKR_OK )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Try to find the object in module&#39;s list first. */</span></div>
<div class="line">        <a class="code" href="iot__pkcs11__mbedtls_8c.html#a48ea28307e7a1e8378b5e704e7318b8b">prvFindObjectInListByLabel</a>( pxSession-&gt;<a class="code" href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">pxFindObjectLabel</a>, pxSession-&gt;<a class="code" href="struct_p11_session__t.html#ad7ba8e3179ffb7d43b037c6ad843735c">xFindObjectLabelLen</a>, &amp;xPalHandle, phObject );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Check with the PAL if the object was previously stored. */</span></div>
<div class="line">        <span class="keywordflow">if</span>( *phObject == CK_INVALID_HANDLE )</div>
<div class="line">        {</div>
<div class="line">            xPalHandle = <a class="code" href="iot__pkcs11__pal_8h.html#aa40ed819a4db63bf1f82ec3a83f7671d">PKCS11_PAL_FindObject</a>( pxSession-&gt;<a class="code" href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">pxFindObjectLabel</a>, pxSession-&gt;<a class="code" href="struct_p11_session__t.html#ad7ba8e3179ffb7d43b037c6ad843735c">xFindObjectLabelLen</a> );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>( xPalHandle != CK_INVALID_HANDLE )</div>
<div class="line">        {</div>
<div class="line">            xResult = <a class="code" href="iot__pkcs11__pal_8h.html#a5f9deac2fdf2dc0ac52e87f95d3d6fb6">PKCS11_PAL_GetObjectValue</a>( xPalHandle, &amp;pucObjectValue, &amp;xObjectLength, &amp;xIsPrivate );</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span>( xResult == CKR_OK )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">for</span>( ulIndex = 0; ulIndex &lt; xObjectLength; ulIndex++ )</div>
<div class="line">                {</div>
<div class="line">                    xByte = pucObjectValue[ ulIndex ];</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span>( xByte != 0UL )</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span>( xByte == 0UL ) <span class="comment">/* Deleted objects are overwritten completely w/ zero. */</span></div>
<div class="line">                {</div>
<div class="line">                    *phObject = CK_INVALID_HANDLE;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    xResult = <a class="code" href="iot__pkcs11__mbedtls_8c.html#a032401bd3b99f1178fa16594123a84ea">prvAddObjectToList</a>( xPalHandle, phObject, pxSession-&gt;<a class="code" href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">pxFindObjectLabel</a>, pxSession-&gt;<a class="code" href="struct_p11_session__t.html#ad7ba8e3179ffb7d43b037c6ad843735c">xFindObjectLabelLen</a> );</div>
<div class="line">                    *pulObjectCount = 1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="iot__pkcs11__pal_8h.html#a62b94691f4534e5328eb88362244e308">PKCS11_PAL_GetObjectValueCleanup</a>( pucObjectValue, xObjectLength );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Note: Objects living in header files are not destroyed. */</span></div>
<div class="line">            <span class="comment">/* According to the PKCS #11 standard, not finding an object results in a CKR_OK return value with an object count of 0. */</span></div>
<div class="line">            *pulObjectCount = 0;</div>
<div class="line">            <a class="code" href="iot__pkcs11__mbedtls_8c.html#a4634eeeeb6af38ed06cd4d4af1fc806c">PKCS11_WARNING_PRINT</a>( ( <span class="stringliteral">&quot;WARN: Object with label &#39;%s&#39; not found. \r\n&quot;</span>, ( <span class="keywordtype">char</span> * ) pxSession-&gt;<a class="code" href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">pxFindObjectLabel</a> ) );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Clean up memory if there was an error finding the object. */</span></div>
<div class="line">    <span class="keywordflow">if</span>( xResult != CKR_OK )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>( pxSession != NULL )</div>
<div class="line">        {</div>
<div class="line">            vPortFree( pxSession-&gt;<a class="code" href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">pxFindObjectLabel</a> );</div>
<div class="line">            pxSession-&gt;<a class="code" href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">pxFindObjectLabel</a> = NULL;</div>
<div class="line">            pxSession-&gt;<a class="code" href="struct_p11_session__t.html#ad7ba8e3179ffb7d43b037c6ad843735c">xFindObjectLabelLen</a> = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> xResult;</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="iot__pkcs11__mbedtls_8c.html#af4d4d071deb07e7dcfa489a2a835756d" title="Initializes an object search operation.">C_FindObjectsInit()</a> which must be called before calling <a class="el" href="iot__pkcs11__mbedtls_8c.html#a42635cbaa2ba78482ae053bea477246a" title="Initializes an object search operation.">C_FindObjects()</a> and <a class="el" href="iot__pkcs11__mbedtls_8c.html#a46347f830269bfbcbece15951f0c0fa4" title="Finishes an object search operation.">C_FindObjectsFinal()</a>, which must be called after.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>FindObjects parameters are shared by a session. Calling <a class="el" href="iot__pkcs11__mbedtls_8c.html#af4d4d071deb07e7dcfa489a2a835756d" title="Initializes an object search operation.">C_FindObjectsInit()</a>, <a class="el" href="iot__pkcs11__mbedtls_8c.html#a42635cbaa2ba78482ae053bea477246a" title="Initializes an object search operation.">C_FindObjects()</a>, and <a class="el" href="iot__pkcs11__mbedtls_8c.html#a46347f830269bfbcbece15951f0c0fa4" title="Finishes an object search operation.">C_FindObjectsFinal()</a> with the same session across different tasks may lead to unexpected results.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hSession</td><td>Handle of a valid PKCS #11 session. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">phObject</td><td>Points to the handle of the object to be found. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ulMaxObjectCount</td><td>The size of the phObject object handle array. In this port, this value should always be set to 1, as searching for multiple objects is not supported. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pulObjectCount</td><td>The actual number of objects that are found. In this port, if an object is found this value will be 1, otherwise if the object is not found, it will be set to 0.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>In the event that an object does not exist, CKR_OK will be returned, but pulObjectCount will be set to 0.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>CKR_OK if successful. Else, see <a href="https://tiny.amazon.com/wtscrttv">PKCS #11 specification</a> for more information. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aiot__pkcs11_8h_html_a30315d302108bcfb354196f37b16a492"><div class="ttname"><a href="iot__pkcs11_8h.html#a30315d302108bcfb354196f37b16a492">CK_DECLARE_FUNCTION</a></div><div class="ttdeci">#define CK_DECLARE_FUNCTION(returnType, name)</div><div class="ttdoc">Macro for defining a PKCS #11 functions.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11.h:66</div></div>
<div class="ttc" id="aiot__pkcs11__pal_8h_html_aa40ed819a4db63bf1f82ec3a83f7671d"><div class="ttname"><a href="iot__pkcs11__pal_8h.html#aa40ed819a4db63bf1f82ec3a83f7671d">PKCS11_PAL_FindObject</a></div><div class="ttdeci">CK_OBJECT_HANDLE PKCS11_PAL_FindObject(CK_BYTE_PTR pxLabel, CK_ULONG usLength)</div><div class="ttdoc">Translates a PKCS #11 label into an object handle.</div></div>
<div class="ttc" id="aiot__pkcs11__mbedtls_8c_html_a42635cbaa2ba78482ae053bea477246a"><div class="ttname"><a href="iot__pkcs11__mbedtls_8c.html#a42635cbaa2ba78482ae053bea477246a">C_FindObjects</a></div><div class="ttdeci">CK_RV C_FindObjects(CK_SESSION_HANDLE hSession, CK_OBJECT_HANDLE_PTR phObject, CK_ULONG ulMaxObjectCount, CK_ULONG_PTR pulObjectCount)</div><div class="ttdoc">Initializes an object search operation.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:2974</div></div>
<div class="ttc" id="aiot__pkcs11__mbedtls_8c_html_a48ea28307e7a1e8378b5e704e7318b8b"><div class="ttname"><a href="iot__pkcs11__mbedtls_8c.html#a48ea28307e7a1e8378b5e704e7318b8b">prvFindObjectInListByLabel</a></div><div class="ttdeci">static void prvFindObjectInListByLabel(const CK_BYTE_PTR pcLabel, CK_ULONG xLabelLength, CK_OBJECT_HANDLE_PTR pxPalHandle, CK_OBJECT_HANDLE_PTR pxAppHandle)</div><div class="ttdoc">Searches the PKCS #11 module's object list for label and provides handle.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:926</div></div>
<div class="ttc" id="aiot__pkcs11__mbedtls_8c_html_a8a3079aa3ce5d51bb787a3e661714ef0"><div class="ttname"><a href="iot__pkcs11__mbedtls_8c.html#a8a3079aa3ce5d51bb787a3e661714ef0">prvSessionPointerFromHandle</a></div><div class="ttdeci">static P11Session_t * prvSessionPointerFromHandle(CK_SESSION_HANDLE xSession)</div><div class="ttdoc">Maps an opaque caller session handle into its internal state structure.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:287</div></div>
<div class="ttc" id="astruct_p11_session__t_html_ad7ba8e3179ffb7d43b037c6ad843735c"><div class="ttname"><a href="struct_p11_session__t.html#ad7ba8e3179ffb7d43b037c6ad843735c">P11Session_t::xFindObjectLabelLen</a></div><div class="ttdeci">CK_ULONG xFindObjectLabelLen</div><div class="ttdoc">Size of current search label.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:222</div></div>
<div class="ttc" id="aiot__pkcs11__pal_8h_html_a62b94691f4534e5328eb88362244e308"><div class="ttname"><a href="iot__pkcs11__pal_8h.html#a62b94691f4534e5328eb88362244e308">PKCS11_PAL_GetObjectValueCleanup</a></div><div class="ttdeci">void PKCS11_PAL_GetObjectValueCleanup(CK_BYTE_PTR pucData, CK_ULONG ulDataSize)</div><div class="ttdoc">Cleanup after PKCS11_GetObjectValue().</div></div>
<div class="ttc" id="aiot__pkcs11__mbedtls_8c_html_ab93c9263b9b89774e57eee9e8ac708a8"><div class="ttname"><a href="iot__pkcs11__mbedtls_8c.html#ab93c9263b9b89774e57eee9e8ac708a8">prvCheckValidSessionAndModule</a></div><div class="ttdeci">static CK_RV prvCheckValidSessionAndModule(const P11Session_t *pxSession)</div><div class="ttdoc">Helper to check if the current session is initialized and valid.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:248</div></div>
<div class="ttc" id="aiot__pkcs11__pal_8h_html_a5f9deac2fdf2dc0ac52e87f95d3d6fb6"><div class="ttname"><a href="iot__pkcs11__pal_8h.html#a5f9deac2fdf2dc0ac52e87f95d3d6fb6">PKCS11_PAL_GetObjectValue</a></div><div class="ttdeci">CK_RV PKCS11_PAL_GetObjectValue(CK_OBJECT_HANDLE xHandle, CK_BYTE_PTR *ppucData, CK_ULONG_PTR pulDataSize, CK_BBOOL *pIsPrivate)</div><div class="ttdoc">Gets the value of an object in storage, by handle.</div></div>
<div class="ttc" id="astruct_p11_session__t_html"><div class="ttname"><a href="struct_p11_session__t.html">P11Session_t</a></div><div class="ttdoc">Session structure.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:217</div></div>
<div class="ttc" id="aiot__pkcs11__mbedtls_8c_html_a032401bd3b99f1178fa16594123a84ea"><div class="ttname"><a href="iot__pkcs11__mbedtls_8c.html#a032401bd3b99f1178fa16594123a84ea">prvAddObjectToList</a></div><div class="ttdeci">static CK_RV prvAddObjectToList(CK_OBJECT_HANDLE xPalHandle, CK_OBJECT_HANDLE_PTR pxAppHandle, const CK_BYTE_PTR pcLabel, CK_ULONG xLabelLength)</div><div class="ttdoc">Add an object that exists in NVM to the application object array.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:1033</div></div>
<div class="ttc" id="aiot__pkcs11__mbedtls_8c_html_a4634eeeeb6af38ed06cd4d4af1fc806c"><div class="ttname"><a href="iot__pkcs11__mbedtls_8c.html#a4634eeeeb6af38ed06cd4d4af1fc806c">PKCS11_WARNING_PRINT</a></div><div class="ttdeci">#define PKCS11_WARNING_PRINT(X)</div><div class="ttdoc">Macro for logging warnings in PKCS #11.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:110</div></div>
<div class="ttc" id="astruct_p11_session__t_html_a1b3bec8cf6fa188a2aca9709c2400188"><div class="ttname"><a href="struct_p11_session__t.html#a1b3bec8cf6fa188a2aca9709c2400188">P11Session_t::pxFindObjectLabel</a></div><div class="ttdeci">CK_BYTE * pxFindObjectLabel</div><div class="ttdoc">Pointer to the label for the search in progress. Should be NULL if no search in progress.</div><div class="ttdef"><b>Definition:</b> iot_pkcs11_mbedtls.c:221</div></div>
<!-- This file provides the custom footer for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20
    </li>
    <li class="footer">
      Last updated Wed Apr 21 2021
    </li>
    <li class="footer" style="float:left">
    </li>
  </ul>
</div>
</body>
</html>