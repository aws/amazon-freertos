<!-- This file provides the custom header for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
        Fleet Provisioning: Tests
    </title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="foobar.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
    <tbody>
        <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">
                    <span id="csdkprefix">AWS IoT Device SDK C:</span>
                    Fleet Provisioning
                </div>
                <div id="projectbrief">
                    AWS IoT Fleet Provisioning
                </div>
            </td>
        </tr>
        <tr>
            <td id="returntomain">
                <a href="../main/index.html">Return to main page &uarr;</a>
            </td>
        </tr>
    </tbody>
    </table>
    </div>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('provisioning_tests.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tests written for the Provisioning library.</p>
<p>The Provisioning tests reside in the <code>provisioning/test</code> directory. They are divided into the following subdirectories:</p><ul>
<li><code>system</code>: Provisioning system tests. These tests require a network connection and AWS IoT credentials. They also need an AWS account and a registered Provisioning Template in the account; see <a class="el" href="provisioning_tests.html#provisioning_system_tests_setup">Setting up Provisioning system tests</a> for instructions to configure an AWS account to run these tests. The command line option <code>-n</code> may be passed to the test executable to disable these tests.</li>
<li><code>unit</code>: Provisioning unit tests. These tests do not require a network connection or credentials. These tests use the <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/mqtt.tag:../mqtt/" href="../mqtt/mqtt_tests.html">MQTT mocks.</a></li>
</ul>
<p>See <a class="el" href="provisioning_tests_config.html">Test Configuration</a> for configuration settings that change the behavior of the Provisioning system tests. The Provisioning unit tests require no special configuration.</p>
<p>The current Provisioning tests use the <a href="http://www.throwtheswitch.org/unity/">Unity test framework</a>. See <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/main.tag:../main/" href="../main/building.html#building_tests">Building and running the tests</a> for a guide on running the tests.</p>
<h1><a class="anchor" id="provisioning_system_tests_setup"></a>
Setting up Provisioning system tests</h1>
<p>How to set up the Provisioning system tests.</p>
<dl class="section pre"><dt>Precondition</dt><dd>The steps below assume basic familiarity with AWS and AWS CLI.</dd></dl>
<p>The Provisioning system tests require a Provisioning Template to be created with an AWS account. AWS does not provide the functionality to create a fleet provisioning template using the Device API; therefore, a fleet provisioning template will have to be created using another method.</p>
<p>See <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/main.tag:../main/" href="../main/guide_developer_automated_tests.html#guide_developer_automated_tests_jobs_and_provisioning">Additional Travis CI setup for Jobs and Provisioning system tests</a> for additional setup for running the Provisioning tests on Travis CI.</p>
<ol type="1">
<li>Create an IAM user for the tests. This needs to be done only once. <br />
 Follow <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html">this guide</a> to create an IAM user for the Provisioning tests.<ul>
<li>Only <b>programmatic access</b> is required.</li>
<li>Save the <b>access key</b> and <b>secret access key</b> for this user.</li>
<li>The following policy grants the necessary permissions for this user. Replace <code>&lt;region&gt;</code> and <code>&lt;account&gt;</code> with your AWS region and account number, respectively; replace <code>&lt;TemplateName&gt;</code> with the name of the Provisioning Template that will be created in the next step (step 2).<br />
 <div class="fragment"><div class="line">{</div><div class="line">    <span class="stringliteral">&quot;Version&quot;</span>: <span class="stringliteral">&quot;2012-10-17&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;Statement&quot;</span>: {</div><div class="line">        <span class="stringliteral">&quot;Effect&quot;</span>: <span class="stringliteral">&quot;Allow&quot;</span>,</div><div class="line">        <span class="stringliteral">&quot;Action&quot;</span>: [</div><div class="line">            <span class="stringliteral">&quot;iot:CreateProvisioningTemplate&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;iot:UpdateProvisioningTemplate&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;iot:DescribeProvisioningTemplate&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;iot:DeleteProvisioningTemplate&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;iot:ListProvisioningTemplates&quot;</span></div><div class="line">        ],</div><div class="line">        <span class="stringliteral">&quot;Resource&quot;</span>: [</div><div class="line">            <span class="stringliteral">&quot;arn:aws:iot:&lt;region&gt;:&lt;account&gt;:provisioningtemplate/*&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;arn:aws:iot:&lt;region&gt;:&lt;account&gt;:service-role/*&quot;</span></div><div class="line">        ]</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --></li>
</ul>
</li>
<li>Create an IAM role that will be needed by a fleet provisioning template. Replace <code>RoleName</code> with a name of the role you want to create. <div class="fragment"><div class="line">aws iam create-role \</div><div class="line">    --role-name &lt;RoleName&gt; \</div><div class="line">    --assume-role-policy-document &#39;{&quot;Version&quot;:&quot;2012-10-17&quot;,&quot;Statement&quot;:[{&quot;Action&quot;:&quot;sts:AssumeRole&quot;,&quot;Effect&quot;:&quot;Allow&quot;,&quot;Principal&quot;:{&quot;Service&quot;:&quot;iot.amazonaws.com&quot;}}]}&#39;</div></div><!-- fragment --></li>
<li>Attach a policy to the role created in step2. Replace <code>RoleName</code> with the name of the role you created in Step 2. <div class="fragment"><div class="line">aws iam attach-role-policy \</div><div class="line">        --role-name &lt;RoleName&gt; \</div><div class="line">        --policy-arn arn:aws:iam::aws:policy/service-role/AWSIoTThingsRegistration</div></div><!-- fragment --></li>
<li>Create the template resource which will be used for provisioning the demo application. This needs to be done only once. <br />
 To create a template, the following AWS CLI command may be used. Replace <code>TemplateName</code> with the name of the fleet provisioning template you want to create. Replace <code>RoleName</code> with the name of the role you created in Step 2. Replace <code>TemplateJSON</code> with the template body as a JSON string (containing escape characters). Replace <code>account</code> with your AWS account number. <div class="fragment"><div class="line">aws iot create-provisioning-template \</div><div class="line">        --template-name &lt;TemplateName&gt; \</div><div class="line">        --provisioning-role-arn arn:aws:iam::&lt;account&gt;:service-role/&lt;RoleName&gt; \</div><div class="line">        --template-body &quot;&lt;TemplateJSON&gt;&quot; \</div><div class="line">        --enabled </div></div><!-- fragment --> For more information on fleet provisioning template, refer to <a href="https://docs.aws.amazon.com/iot/latest/developerguide/provision-template.html#fleet-provision-template">this guide</a> Following is an example template JSON string (that uses "SerialNumber" for Thing resource name and accepts an additional "DeviceLocation" parameter) which can be viewed on AWS IoT Console after the AWS CLI command using it is executed <br />
 <div class="fragment"><div class="line">{\<span class="stringliteral">&quot;Parameters\&quot;:{\&quot;DeviceLocation\&quot;:{\&quot;Type\&quot;:\&quot;String\&quot;},\&quot;AWS::IoT::Certificate::Id\&quot;:{\&quot;Type\&quot;:\&quot;String\&quot;},\&quot;SerialNumber\&quot;:{\&quot;Type\&quot;:\&quot;String\&quot;}},\&quot;Mappings\&quot;:{\&quot;LocationTable\&quot;:{\&quot;Seattle\&quot;:{\&quot;LocationUrl\&quot;:\&quot;https://example.aws\&quot;}}},\&quot;Resources\&quot;:{\&quot;thing\&quot;:{\&quot;Type\&quot;:\&quot;AWS::IoT::Thing\&quot;,\&quot;Properties\&quot;:{\&quot;ThingName\&quot;:{\&quot;Fn::Join\&quot;:[\&quot;\&quot;,[\&quot;ThingPrefix_\&quot;,{\&quot;Ref\&quot;:\&quot;SerialNumber\&quot;}]]},\&quot;AttributePayload\&quot;:{\&quot;version\&quot;:\&quot;v1\&quot;,\&quot;serialNumber\&quot;:\&quot;serialNumber\&quot;}},\&quot;OverrideSettings\&quot;:{\&quot;AttributePayload\&quot;:\&quot;MERGE\&quot;,\&quot;ThingTypeName\&quot;:\&quot;REPLACE\&quot;,\&quot;ThingGroups\&quot;:\&quot;DO_NOTHING\&quot;}},\&quot;certificate\&quot;:{\&quot;Type\&quot;:\&quot;AWS::IoT::Certificate\&quot;,\&quot;Properties\&quot;:{\&quot;CertificateId\&quot;:{\&quot;Ref\&quot;:\&quot;AWS::IoT::Certificate::Id\&quot;},\&quot;Status\&quot;:\&quot;Active\&quot;},\&quot;OverrideSettings\&quot;:{\&quot;Status\&quot;:\&quot;REPLACE\&quot;}},\&quot;policy\&quot;:{\&quot;Type\&quot;:\&quot;AWS::IoT::Policy\&quot;,\&quot;Properties\&quot;:{\&quot;PolicyDocument\&quot;:{\&quot;Version\&quot;:\&quot;2012-10-17\&quot;,\&quot;Statement\&quot;:[{\&quot;Effect\&quot;:\&quot;Allow\&quot;,\&quot;Action\&quot;:[\&quot;iot:Connect\&quot;,\&quot;iot:Subscribe\&quot;,\&quot;iot:Publish\&quot;,\&quot;iot:Receive\&quot;],\&quot;Resource\&quot;:\&quot;*\&quot;}]}}}},\&quot;DeviceConfiguration\&quot;:{\&quot;FallbackUrl\&quot;:\&quot;https://www.example.com/test-site\&quot;,\&quot;LocationUrl\&quot;:{\&quot;Fn::FindInMap\&quot;:[\&quot;LocationTable\&quot;,{\&quot;Ref\&quot;:\&quot;DeviceLocation\&quot;},\&quot;LocationUrl\&quot;]}}}</span></div></div><!-- fragment --> You can query the created template using the following CLI command. Replace the <code>TemplateName</code> with the fleet provisioning template you created. <div class="fragment"><div class="line">aws iot describe-provisioning-template --template-name &lt;TemplateName&gt;</div></div><!-- fragment --></li>
<li>Set the name of provisioning template, created in step 4, in the config file for the <code>AWS_IOT_TEST_PROVISIONING_TEMPLATE_NAME</code> macro. Build the tests for the <code>aws_iot_tests_provisioning</code> target.<br />
</li>
<li>When the Provisioning tests are complete, the provisioning template it used is no longer needed. Provisioning templates can be deleted with the following command, where <code>TemplateName</code> is the name of the template that is to be deleted. Replace the <code>&lt;TemplateName&gt;</code> with the name of the provisioning template created in Step 4. <div class="fragment"><div class="line">aws iot delete-provisioning-template --template-name &lt;TemplateName&gt; </div></div><!-- fragment --> </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- This file provides the custom footer for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14
    </li>
    <li class="footer">
      Last updated Thu Apr 30 2020
    </li>
    <li class="footer" style="float:left">
        SDK version 4.0.0b1
    </li>
  </ul>
</div>
</body>
</html>
