<!-- This file provides the custom header for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
        MQTT: IotMqtt_SubscribeAsync
    </title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="foobar.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
    <tbody>
        <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">
                    <span id="csdkprefix">AWS IoT Device SDK C:</span>
                    MQTT
                </div>
                <div id="projectbrief">
                    MQTT 3.1.1 client library
                </div>
            </td>
        </tr>
        <tr>
            <td id="returntomain">
                <a href="../main/index.html">Return to main page &uarr;</a>
            </td>
        </tr>
    </tbody>
    </table>
    </div>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('mqtt_function_subscribeasync.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">IotMqtt_SubscribeAsync </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Subscribes to the given array of topic filters and optionally receive an asynchronous notification when the subscribe completes.</p>
<div class="fragment"><div class="line"><a class="code" href="group__mqtt__datatypes__enums.html#ga47b87de32b8c83c88d68e9b9c26d1346">IotMqttError_t</a> <a class="code" href="iot__mqtt_8h.html#a140c39dd6f8942ff46f043b4598feb32">IotMqtt_SubscribeAsync</a>( <a class="code" href="group__mqtt__datatypes__handles.html#ga4780ec2a55c4c322e9f5b7ce9dec3cf7">IotMqttConnection_t</a> mqttConnection,</div><div class="line">                                       <span class="keyword">const</span> <a class="code" href="structIotMqttSubscription__t.html">IotMqttSubscription_t</a> * pSubscriptionList,</div><div class="line">                                       <span class="keywordtype">size_t</span> subscriptionCount,</div><div class="line">                                       uint32_t flags,</div><div class="line">                                       <span class="keyword">const</span> <a class="code" href="structIotMqttCallbackInfo__t.html">IotMqttCallbackInfo_t</a> * pCallbackInfo,</div><div class="line">                                       <a class="code" href="group__mqtt__datatypes__handles.html#ga5bb524e56bd78e95e04d5b2c1aaf560a">IotMqttOperation_t</a> * <span class="keyword">const</span> pSubscribeOperation );</div></div><!-- fragment --><p>This function sends an MQTT SUBSCRIBE packet to the server. A SUBSCRIBE packet notifies the server to send any matching PUBLISH messages to this client. A single SUBSCRIBE packet may carry more than one topic filter, hence the parameters to this function include an array of <a class="el" href="structIotMqttSubscription__t.html">subscriptions</a>.</p>
<p>An MQTT subscription has two pieces:</p><ol type="1">
<li>The subscription topic filter registered with the MQTT server. The MQTT SUBSCRIBE packet sent from this client to server notifies the server to send messages matching the given topic filters to this client.</li>
<li>The <a class="el" href="structIotMqttCallbackInfo__t.html#a8ad8cdffb834fd2282b787d3ba9adc98">callback function</a> that this client will invoke when an incoming message is received. The callback function notifies applications of an incoming PUBLISH message.</li>
</ol>
<p>The helper function <a class="el" href="mqtt_function_issubscribed.html">IotMqtt_IsSubscribed</a> can be used to check if a <a class="el" href="structIotMqttCallbackInfo__t.html#a8ad8cdffb834fd2282b787d3ba9adc98">callback function</a> is registered for a particular topic filter.</p>
<p>To modify an already-registered subscription callback, call this function with a new <code>pSubscriptionList</code>. Any topic filters in <code>pSubscriptionList</code> that already have a registered callback will be replaced with the new values in <code>pSubscriptionList</code>.</p>
<dl class="section attention"><dt>Attention</dt><dd>QoS 2 subscriptions are currently unsupported. Only 0 or 1 are valid for subscription QoS.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mqttConnection</td><td>The MQTT connection to use for the subscription. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pSubscriptionList</td><td>Pointer to the first element in the array of subscriptions. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">subscriptionCount</td><td>The number of elements in pSubscriptionList. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Flags which modify the behavior of this function. See <a class="el" href="mqtt_constants.html#mqtt_constants_flags">MQTT Function Flags</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pCallbackInfo</td><td>Asynchronous notification of this function's completion (<code>NULL</code> to disable). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pSubscribeOperation</td><td>Set to a handle by which this operation may be referenced after this function returns. This reference is invalidated once the subscription operation completes.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function will return <a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ade50c4de21a5a5efef69d4c5124f1d9a" title="MQTT operation queued, awaiting result. ">IOT_MQTT_STATUS_PENDING</a> upon success. </dd>
<dd>
Upon completion of the subscription (either through an <a class="el" href="structIotMqttCallbackInfo__t.html" title="MQTT callback function and context. ">IotMqttCallbackInfo_t</a> or <a class="el" href="mqtt_function_wait.html">IotMqtt_Wait</a>), the status will be one of:<ul>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a2e6e37bd8e04b70023e4c6a2dc173ce1" title="MQTT operation completed successfully. ">IOT_MQTT_SUCCESS</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346aab444b9564a475ec08fd132c9802bfbf" title="MQTT operation failed because the network was unusable. ">IOT_MQTT_NETWORK_ERROR</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a6190b9ffdd1f746fba080ea93e18deb5" title="MQTT operation could not be scheduled, i.e. enqueued for sending. ">IOT_MQTT_SCHEDULING_ERROR</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346aeb00267bdcea595c7a80adf0ce480693" title="MQTT response packet received from the network is malformed. ">IOT_MQTT_BAD_RESPONSE</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346abd1e37172ef79cc536d2215fb0fcf1de" title="A CONNECT or at least one subscription was refused by the server. ">IOT_MQTT_SERVER_REFUSED</a> </li>
</ul>
</dd>
<dd>
If this function fails before queuing a subscribe operation, it will return one of:<ul>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a995647b885d06fbc38a16f8568a7838c" title="An API function was called before IotMqtt_Init. ">IOT_MQTT_NOT_INITIALIZED</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ae6682170afde44d00fdbc271427d9a42" title="At least one parameter is invalid. ">IOT_MQTT_BAD_PARAMETER</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ab481ade10eabf458213959b070386463" title="MQTT operation failed because of memory allocation failure. ">IOT_MQTT_NO_MEMORY</a></li>
</ul>
</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="mqtt_function_subscribesync.html">IotMqtt_SubscribeSync</a> for a blocking variant of this function. </dd>
<dd>
<a class="el" href="mqtt_function_unsubscribeasync.html">IotMqtt_UnsubscribeAsync</a> for the function that removes subscriptions.</dd></dl>
<p><b>Example</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#define NUMBER_OF_SUBSCRIPTIONS ...</span></div><div class="line"></div><div class="line"><span class="comment">// Subscription callback function.</span></div><div class="line"><span class="keywordtype">void</span> subscriptionCallback( <span class="keywordtype">void</span> * pArgument, <a class="code" href="structIotMqttCallbackParam__t.html">IotMqttCallbackParam_t</a> * pPublish );</div><div class="line"></div><div class="line"><span class="comment">// An initialized and connected MQTT connection.</span></div><div class="line"><a class="code" href="group__mqtt__datatypes__handles.html#ga4780ec2a55c4c322e9f5b7ce9dec3cf7">IotMqttConnection_t</a> mqttConnection;</div><div class="line"></div><div class="line"><span class="comment">// Subscription information.</span></div><div class="line">pSubscriptions[ NUMBER_OF_SUBSCRIPTIONS ] = { <a class="code" href="iot__mqtt__types_8h.html#a48ae008ec0ee92719366e2804a1e922f">IOT_MQTT_SUBSCRIPTION_INITIALIZER</a> };</div><div class="line"><a class="code" href="group__mqtt__datatypes__handles.html#ga5bb524e56bd78e95e04d5b2c1aaf560a">IotMqttOperation_t</a> lastOperation = <a class="code" href="iot__mqtt__types_8h.html#a3d0b09a3f85b525bdc7d3e3a352c9596">IOT_MQTT_OPERATION_INITIALIZER</a>;</div><div class="line"></div><div class="line"><span class="comment">// Set the subscription information.</span></div><div class="line"><span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; NUMBER_OF_SUBSCRIPTIONS; i++ )</div><div class="line">{</div><div class="line">    pSubscriptions[ i ].qos = <a class="code" href="group__mqtt__datatypes__enums.html#gga974a9cdcc8e835aab6f1bf6d90365db6a7e8be13a11f451e3837a3f86175e9f86">IOT_MQTT_QOS_1</a>;</div><div class="line">    pSubscriptions[ i ].pTopicFilter = <span class="stringliteral">&quot;some/topic/filter&quot;</span>;</div><div class="line">    pSubscriptions[ i ].topicLength = ( uint16_t ) strlen( pSubscriptions[ i ].pTopicFilter );</div><div class="line">    pSubscriptions[ i ].callback.function = subscriptionCallback;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__mqtt__datatypes__enums.html#ga47b87de32b8c83c88d68e9b9c26d1346">IotMqttError_t</a> result = <a class="code" href="iot__mqtt_8h.html#a140c39dd6f8942ff46f043b4598feb32">IotMqtt_SubscribeAsync</a>( mqttConnection,</div><div class="line">                                                pSubscriptions,</div><div class="line">                                                NUMBER_OF_SUBSCRIPTIONS,</div><div class="line">                                                <a class="code" href="iot__mqtt__types_8h.html#ab496d15856f22cda8d874894149dad5c">IOT_MQTT_FLAG_WAITABLE</a>,</div><div class="line">                                                NULL,</div><div class="line">                                                &amp;lastOperation );</div><div class="line"></div><div class="line"><span class="comment">// Subscribe returns IOT_MQTT_STATUS_PENDING when successful. Wait up to</span></div><div class="line"><span class="comment">// 5 seconds for the operation to complete.</span></div><div class="line"><span class="keywordflow">if</span>( result == <a class="code" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ade50c4de21a5a5efef69d4c5124f1d9a">IOT_MQTT_STATUS_PENDING</a> )</div><div class="line">{</div><div class="line">    result = <a class="code" href="iot__mqtt_8h.html#a1b27dc0cc346492f576c9d68aa808bfe">IotMqtt_Wait</a>( subscriptionRef, 5000 );</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Check that the subscriptions were successful.</span></div><div class="line"><span class="keywordflow">if</span>( result == <a class="code" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a2e6e37bd8e04b70023e4c6a2dc173ce1">IOT_MQTT_SUCCESS</a> )</div><div class="line">{</div><div class="line">    <span class="comment">// Wait for messages on the subscription topic filters...</span></div><div class="line"></div><div class="line">    <span class="comment">// Unsubscribe once the subscriptions are no longer needed.</span></div><div class="line">    result = <a class="code" href="iot__mqtt_8h.html#a24f6448383fb48b07aa6701487c8003b">IotMqtt_UnsubscribeAsync</a>( mqttConnection,</div><div class="line">                                       pSubscriptions,</div><div class="line">                                       NUMBER_OF_SUBSCRIPTIONS,</div><div class="line">                                       <a class="code" href="iot__mqtt__types_8h.html#ab496d15856f22cda8d874894149dad5c">IOT_MQTT_FLAG_WAITABLE</a>,</div><div class="line">                                       NULL,</div><div class="line">                                       &amp;lastOperation );</div><div class="line"></div><div class="line">    <span class="comment">// UNSUBSCRIBE returns IOT_MQTT_STATUS_PENDING when successful.</span></div><div class="line">    <span class="comment">// Wait up to 5 seconds for the operation to complete.</span></div><div class="line">    <span class="keywordflow">if</span>( result == <a class="code" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ade50c4de21a5a5efef69d4c5124f1d9a">IOT_MQTT_STATUS_PENDING</a> )</div><div class="line">    {</div><div class="line">        result = <a class="code" href="iot__mqtt_8h.html#a1b27dc0cc346492f576c9d68aa808bfe">IotMqtt_Wait</a>( lastOperation, 5000 );</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">// Check which subscriptions were rejected by the server.</span></div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>( result == <a class="code" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346abd1e37172ef79cc536d2215fb0fcf1de">IOT_MQTT_SERVER_REFUSED</a> )</div><div class="line">{</div><div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; NUMBER_OF_SUBSCRIPTIONS; i++ )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="iot__mqtt_8h.html#a00dee190d6294e472ffd695509ee14b6">IotMqtt_IsSubscribed</a>( mqttConnection,</div><div class="line">                                  pSubscriptions[ i ].pTopicFilter,</div><div class="line">                                  pSubscriptions[ i ].topicFilterLength,</div><div class="line">                                  NULL ) == <span class="keyword">false</span> )</div><div class="line">        {</div><div class="line">            <span class="comment">// This subscription was rejected.</span></div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- This file provides the custom footer for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14
    </li>
    <li class="footer">
      Last updated Thu Apr 30 2020
    </li>
    <li class="footer" style="float:left">
        SDK version 4.0.0b1
    </li>
  </ul>
</div>
</body>
</html>
