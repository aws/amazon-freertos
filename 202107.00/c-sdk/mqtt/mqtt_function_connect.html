<!-- This file provides the custom header for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
        MQTT: IotMqtt_Connect
    </title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="foobar.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
    <tbody>
        <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">
                    <span id="csdkprefix">AWS IoT Device SDK C:</span>
                    MQTT
                </div>
                <div id="projectbrief">
                    MQTT 3.1.1 client library
                </div>
            </td>
        </tr>
        <tr>
            <td id="returntomain">
                <a href="../main/index.html">Return to main page &uarr;</a>
            </td>
        </tr>
    </tbody>
    </table>
    </div>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('mqtt_function_connect.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">IotMqtt_Connect </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Establish a new MQTT connection.</p>
<div class="fragment"><div class="line"><a class="code" href="group__mqtt__datatypes__enums.html#ga47b87de32b8c83c88d68e9b9c26d1346">IotMqttError_t</a> <a class="code" href="iot__mqtt_8h.html#a9491d1d41dd327e3e1020a5ae40e099e">IotMqtt_Connect</a>( <span class="keyword">const</span> <a class="code" href="structIotMqttNetworkInfo__t.html">IotMqttNetworkInfo_t</a> * pNetworkInfo,</div><div class="line">                                <span class="keyword">const</span> <a class="code" href="structIotMqttConnectInfo__t.html">IotMqttConnectInfo_t</a> * pConnectInfo,</div><div class="line">                                uint32_t timeoutMs,</div><div class="line">                                <a class="code" href="group__mqtt__datatypes__handles.html#ga4780ec2a55c4c322e9f5b7ce9dec3cf7">IotMqttConnection_t</a> * <span class="keyword">const</span> pMqttConnection );</div></div><!-- fragment --><p>This function opens a connection between a new MQTT client and an MQTT server (also called a <em>broker</em>). MQTT connections are established on top of transport layer protocols (such as TCP/IP), and optionally, application layer security protocols (such as TLS). The MQTT packet that establishes a connection is called the MQTT CONNECT packet. After <a class="el" href="mqtt_function_init.html">IotMqtt_Init</a>, this function must be called before any other MQTT library function.</p>
<p>If <a class="el" href="structIotMqttConnectInfo__t.html#a7c1ee639c15085caa74f16aacf5d6c8c">pConnectInfo-&gt;cleanSession</a> is <code>true</code>, this function establishes a clean MQTT session. Subscriptions and unacknowledged PUBLISH messages will be discarded when the connection is closed.</p>
<p>If <a class="el" href="structIotMqttConnectInfo__t.html#a7c1ee639c15085caa74f16aacf5d6c8c">pConnectInfo-&gt;cleanSession</a> is <code>false</code>, this function establishes (or re-establishes) a persistent MQTT session. The parameters <a class="el" href="structIotMqttConnectInfo__t.html#af8b19dd2558ca1dcda19b4e0e75e477e">pConnectInfo-&gt;pPreviousSubscriptions</a> and <a class="el" href="structIotMqttConnectInfo__t.html#a295eddcf48256963cca1b13cf2abf2c7">pConnectInfo-&gt;previousSubscriptionCount</a> may be used to restore subscriptions present in a re-established persistent session. Any restored subscriptions <b>MUST</b> have been present in the persistent session; <b>this function does not send an MQTT SUBSCRIBE packet!</b></p>
<p><a class="el" href="structIotMqttConnectInfo__t.html#af8b19dd2558ca1dcda19b4e0e75e477e">pConnectInfo-&gt;pPreviousSubscriptions</a> and <a class="el" href="structIotMqttConnectInfo__t.html#a295eddcf48256963cca1b13cf2abf2c7">pConnectInfo-&gt;previousSubscriptionCount</a> can also be used to pass a list of subscriptions to be stored locally without a SUBSCRIBE packet being sent to the broker. These subscriptions are useful to invoke application level callbacks for messages received on unsolicited topics from the broker.</p>
<p>This MQTT library is network agnostic, meaning it has no knowledge of the underlying network protocol carrying the MQTT packets. It interacts with the network through a network abstraction layer, allowing it to be used with many different network stacks. The network abstraction layer is established per-connection, allowing every <a class="el" href="group__mqtt__datatypes__handles.html#ga4780ec2a55c4c322e9f5b7ce9dec3cf7" title="Opaque handle of an MQTT connection. ">IotMqttConnection_t</a> to use a different network stack. The parameter <code>pNetworkInterface</code> sets up the network abstraction layer for an MQTT connection; see the documentation on <a class="el" href="structIotMqttNetworkInfo__t.html" title="MQTT network connection details. ">IotMqttNetworkInfo_t</a> for details on its members.</p>
<p>The <code>pConnectInfo</code> parameter provides the contents of the MQTT CONNECT packet. Most members <a class="el" href="structIotMqttConnectInfo__t.html">are defined by the MQTT spec.</a>. The <a class="el" href="structIotMqttConnectInfo__t.html#af6b8c985f015bb8d85a60e08dda36c11">pConnectInfo-&gt;pWillInfo</a> member provides information on a Last Will and Testament (LWT) message to be published if the MQTT connection is closed without <a class="el" href="mqtt_function_disconnect.html">sending a DISCONNECT packet</a>. Unlike other PUBLISH messages, a LWT message payload is limited to 65535 bytes in length. Additionally, the retry <a class="el" href="structIotMqttPublishInfo__t.html#aba435c0af41d6146bafa04d56cce3c80">interval</a> and <a class="el" href="structIotMqttPublishInfo__t.html#a9da2582d17581ae022f8061cdaecf62b">limit</a> members of <a class="el" href="structIotMqttPublishInfo__t.html" title="Information on a PUBLISH message. ">IotMqttPublishInfo_t</a> are ignored for LWT messages. The LWT message is optional; <code>pWillInfo</code> may be NULL.</p>
<p>MQTT keep-alive is configured by <a class="el" href="structIotMqttConnectInfo__t.html#accfc0aa36662cbe90c92eaf65ca67242">IotMqttConnectInfo_t::keepAliveSeconds</a>. Keep-alive is used to detect half-open or otherwise unusable network connections. An MQTT client will send periodic ping requests (PINGREQ) to the server if the connection is idle. The MQTT server must respond to ping requests with a ping response (PINGRESP). The standard does not specify how long the server has to respond to a ping request, noting only a "reasonable amount of time". In this library, the amount of time a server has to respond to a ping request is set with <a class="el" href="mqtt_config.html#IOT_MQTT_RESPONSE_WAIT_MS">IOT_MQTT_RESPONSE_WAIT_MS</a>.</p>
<p>Unlike <a class="el" href="mqtt_function_publishasync.html">IotMqtt_PublishAsync</a>, <a class="el" href="mqtt_function_subscribeasync.html">IotMqtt_SubscribeAsync</a>, and <a class="el" href="mqtt_function_unsubscribeasync.html">IotMqtt_UnsubscribeAsync</a>, this function is always blocking. Additionally, because the MQTT connection acknowledgement packet (CONNACK packet) does not contain any information on <em>which</em> CONNECT packet it acknowledges, only one CONNECT operation may be in progress at any time. This means that parallel threads making calls to <a class="el" href="mqtt_function_connect.html">IotMqtt_Connect</a> will be serialized to send their CONNECT packets one-by-one.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pNetworkInfo</td><td>Information on the transport-layer network connection to use with the MQTT connection. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pConnectInfo</td><td>MQTT connection setup parameters. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeoutMs</td><td>If the MQTT server does not accept the connection within this timeout in milliseconds, this function returns <a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ad82bd763f70681413ad415be410f71cd" title="A blocking MQTT operation timed out. ">IOT_MQTT_TIMEOUT</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pMqttConnection</td><td>Set to a newly-initialized MQTT connection handle if this function succeeds.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>One of the following:<ul>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a2e6e37bd8e04b70023e4c6a2dc173ce1" title="MQTT operation completed successfully. ">IOT_MQTT_SUCCESS</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a995647b885d06fbc38a16f8568a7838c" title="An API function was called before IotMqtt_Init. ">IOT_MQTT_NOT_INITIALIZED</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ae6682170afde44d00fdbc271427d9a42" title="At least one parameter is invalid. ">IOT_MQTT_BAD_PARAMETER</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ab481ade10eabf458213959b070386463" title="MQTT operation failed because of memory allocation failure. ">IOT_MQTT_NO_MEMORY</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346aab444b9564a475ec08fd132c9802bfbf" title="MQTT operation failed because the network was unusable. ">IOT_MQTT_NETWORK_ERROR</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a6190b9ffdd1f746fba080ea93e18deb5" title="MQTT operation could not be scheduled, i.e. enqueued for sending. ">IOT_MQTT_SCHEDULING_ERROR</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346aeb00267bdcea595c7a80adf0ce480693" title="MQTT response packet received from the network is malformed. ">IOT_MQTT_BAD_RESPONSE</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346ad82bd763f70681413ad415be410f71cd" title="A blocking MQTT operation timed out. ">IOT_MQTT_TIMEOUT</a></li>
<li><a class="el" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346abd1e37172ef79cc536d2215fb0fcf1de" title="A CONNECT or at least one subscription was refused by the server. ">IOT_MQTT_SERVER_REFUSED</a></li>
</ul>
</dd></dl>
<p><b>Example</b> </p><div class="fragment"><div class="line"><span class="comment">// Callback function to receive messages from the broker on an unsolicited topic.</span></div><div class="line"><span class="keywordtype">void</span> unsolicitedMessageCallback( <span class="keywordtype">void</span> * pArgument, <a class="code" href="structIotMqttCallbackParam__t.html">IotMqttCallbackParam_t</a> * pPublish );</div><div class="line"></div><div class="line"><span class="comment">// Parameters to MQTT connect.</span></div><div class="line"><a class="code" href="group__mqtt__datatypes__handles.html#ga4780ec2a55c4c322e9f5b7ce9dec3cf7">IotMqttConnection_t</a> mqttConnection = <a class="code" href="iot__mqtt__types_8h.html#a0d1074df195de1389d14228a4e814d06">IOT_MQTT_CONNECTION_INITIALIZER</a>;</div><div class="line"><a class="code" href="structIotMqttNetworkInfo__t.html">IotMqttNetworkInfo_t</a> networkInfo = <a class="code" href="iot__mqtt__types_8h.html#a95c43f792fefa1b157626b3863e134d3">IOT_MQTT_NETWORK_INFO_INITIALIZER</a>;</div><div class="line"><a class="code" href="structIotMqttConnectInfo__t.html">IotMqttConnectInfo_t</a> connectInfo = <a class="code" href="iot__mqtt__types_8h.html#ac85620aac6913efc9e6742a4aa76c69c">IOT_MQTT_CONNECT_INFO_INITIALIZER</a>;</div><div class="line"><a class="code" href="structIotMqttPublishInfo__t.html">IotMqttPublishInfo_t</a> willInfo = <a class="code" href="iot__mqtt__types_8h.html#a2a183f34dae37e042f00b63cf8a22564">IOT_MQTT_PUBLISH_INFO_INITIALIZER</a>;</div><div class="line"></div><div class="line"><span class="comment">// A local subscription to receive messages from the broker on an unsolicited topic.</span></div><div class="line"><a class="code" href="structIotMqttSubscription__t.html">IotMqttSubscription_t</a> subscription = <a class="code" href="iot__mqtt__types_8h.html#a48ae008ec0ee92719366e2804a1e922f">IOT_MQTT_SUBSCRIPTION_INITIALIZER</a>;</div><div class="line"></div><div class="line"><span class="comment">// Example network abstraction types.</span></div><div class="line"><a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/group__platform__datatypes__handles.html#ga1d14065e75d926b25e7f9e66f3b932af">IotNetworkServerInfo_t</a> serverInfo = { ... };</div><div class="line"><a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/group__platform__datatypes__handles.html#gae77b3fea8710d8f972f7848dbd20e8e0">IotNetworkCredentials_t</a> credentialInfo = { ... };</div><div class="line"><a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkInterface__t.html">IotNetworkInterface_t</a> networkInterface = { ... };</div><div class="line"></div><div class="line"><span class="comment">// Example using a generic network implementation.</span></div><div class="line">networkInfo.<a class="code" href="structIotMqttNetworkInfo__t.html#a93287a7d47f84bc160bf3dcddb338fde">createNetworkConnection</a> = <span class="keyword">true</span>;</div><div class="line">networkInfo.<a class="code" href="structIotMqttNetworkInfo__t.html#a5489253fc2f6024f13460187fc809910">u</a>.setup.pNetworkServerInfo = &amp;serverInfo;</div><div class="line">networkInfo.<a class="code" href="structIotMqttNetworkInfo__t.html#a5489253fc2f6024f13460187fc809910">u</a>.setup.pNetworkCredentialInfo = &amp;credentialInfo;</div><div class="line">networkInfo.<a class="code" href="structIotMqttNetworkInfo__t.html#ade7f3b72fa18293d1f2fbcfadfcbbf37">pNetworkInterface</a> = &amp;networkInterface;</div><div class="line"></div><div class="line"><span class="comment">// Set the members of the connection info (password and username not used).</span></div><div class="line">connectInfo.<a class="code" href="structIotMqttConnectInfo__t.html#a7c1ee639c15085caa74f16aacf5d6c8c">cleanSession</a> = <span class="keyword">true</span>;</div><div class="line">connectInfo.<a class="code" href="structIotMqttConnectInfo__t.html#accfc0aa36662cbe90c92eaf65ca67242">keepAliveSeconds</a> = 30;</div><div class="line">connectInfo.<a class="code" href="structIotMqttConnectInfo__t.html#a3f560e3658cc6aa0aaa3c3ddd1383137">pClientIdentifier</a> = <span class="stringliteral">&quot;uniqueclientidentifier&quot;</span>;</div><div class="line">connectInfo.<a class="code" href="structIotMqttConnectInfo__t.html#a1e16cc20774bc1e17031c5a04340c9b0">clientIdentifierLength</a> = 22;</div><div class="line"></div><div class="line"><span class="comment">// Set the members of the will info (retain and retry not used).</span></div><div class="line">willInfo.<a class="code" href="structIotMqttPublishInfo__t.html#a483e9224f18a5d0cca607ca5dee5bad4">qos</a> = <a class="code" href="group__mqtt__datatypes__enums.html#gga974a9cdcc8e835aab6f1bf6d90365db6a7e8be13a11f451e3837a3f86175e9f86">IOT_MQTT_QOS_1</a>;</div><div class="line">willInfo.<a class="code" href="structIotMqttPublishInfo__t.html#a7242bf67c6a74d6659e6ae78d3008c52">pTopicName</a> = <span class="stringliteral">&quot;will/topic/name&quot;</span>;</div><div class="line">willInfo.<a class="code" href="structIotMqttPublishInfo__t.html#a93b0c97558bd24ba6324c228ec84e684">topicNameLength</a> = ( uint16_t ) strlen( willInfo.<a class="code" href="structIotMqttPublishInfo__t.html#a7242bf67c6a74d6659e6ae78d3008c52">pTopicName</a> );</div><div class="line">willInfo.<a class="code" href="structIotMqttPublishInfo__t.html#a5b4df4baeab5357db34df56d979ef044">pPayload</a> = <span class="stringliteral">&quot;MQTT client unexpectedly disconnected.&quot;</span>;</div><div class="line">willInfo.<a class="code" href="structIotMqttPublishInfo__t.html#a5c223cae824741c2c8cb3bc27102ec79">payloadLength</a> = strlen( willInfo.<a class="code" href="structIotMqttPublishInfo__t.html#a5b4df4baeab5357db34df56d979ef044">pPayload</a> );</div><div class="line"></div><div class="line"><span class="comment">// Set the pointer to the will info.</span></div><div class="line">connectInfo.<a class="code" href="structIotMqttConnectInfo__t.html#af6b8c985f015bb8d85a60e08dda36c11">pWillInfo</a> = &amp;willInfo;</div><div class="line"></div><div class="line"><span class="comment">// [Optional] Set a local subscription to receive the broker messages on an unsolicited topic.</span></div><div class="line">subscription.<a class="code" href="structIotMqttSubscription__t.html#ac69481fe2236fecc936aa41ee47e50a5">qos</a> = <a class="code" href="group__mqtt__datatypes__enums.html#gga974a9cdcc8e835aab6f1bf6d90365db6a81c90cd35b94c7dca50242808b05e7eb">IOT_MQTT_QOS_0</a>;</div><div class="line">subscription.<a class="code" href="structIotMqttSubscription__t.html#af8eecdfcec488790e377b1025ba0e42a">pTopicFilter</a> = <span class="stringliteral">&quot;some/unsolicited/topic&quot;</span>;</div><div class="line">subscription.topicLength = ( uint16_t ) strlen( subscription.<a class="code" href="structIotMqttSubscription__t.html#af8eecdfcec488790e377b1025ba0e42a">pTopicFilter</a> );</div><div class="line">subscription.<a class="code" href="structIotMqttSubscription__t.html#a8a45a7c71a222d5eeac809d6a8028448">callback</a>.<a class="code" href="structIotMqttCallbackInfo__t.html#a8ad8cdffb834fd2282b787d3ba9adc98">function</a> = unsolicitedMessageCallback;</div><div class="line">connectInfo.<a class="code" href="structIotMqttConnectInfo__t.html#af8b19dd2558ca1dcda19b4e0e75e477e">pPreviousSubscriptions</a> = &amp;subscription;</div><div class="line">connectInfo.<a class="code" href="structIotMqttConnectInfo__t.html#a295eddcf48256963cca1b13cf2abf2c7">previousSubscriptionCount</a> = 1;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Call CONNECT with a 5 second block time. Should return</span></div><div class="line"><span class="comment">// IOT_MQTT_SUCCESS when successful.</span></div><div class="line"><a class="code" href="group__mqtt__datatypes__enums.html#ga47b87de32b8c83c88d68e9b9c26d1346">IotMqttError_t</a> result = <a class="code" href="iot__mqtt_8h.html#a9491d1d41dd327e3e1020a5ae40e099e">IotMqtt_Connect</a>( &amp;networkInfo,</div><div class="line">                                         &amp;connectInfo,</div><div class="line">                                         5000,</div><div class="line">                                         &amp;mqttConnection );</div><div class="line"></div><div class="line"><span class="keywordflow">if</span>( result == <a class="code" href="group__mqtt__datatypes__enums.html#gga47b87de32b8c83c88d68e9b9c26d1346a2e6e37bd8e04b70023e4c6a2dc173ce1">IOT_MQTT_SUCCESS</a> )</div><div class="line">{</div><div class="line">    <span class="comment">// Do something with the MQTT connection...</span></div><div class="line"></div><div class="line">    <span class="comment">// Clean up and close the MQTT connection once it&#39;s no longer needed.</span></div><div class="line">    <a class="code" href="iot__mqtt_8h.html#ac14aedb6fbf3e907b3146124ae0b9611">IotMqtt_Disconnect</a>( mqttConnection, 0 );</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- This file provides the custom footer for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14
    </li>
    <li class="footer">
      Last updated Thu Apr 30 2020
    </li>
    <li class="footer" style="float:left">
        SDK version 4.0.0b1
    </li>
  </ul>
</div>
</body>
</html>
