<!-- This file provides the custom header for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
        Shadow: AwsIotShadow_GetAsync
    </title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="foobar.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
    <tbody>
        <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">
                    <span id="csdkprefix">AWS IoT Device SDK C:</span>
                    Shadow
                </div>
                <div id="projectbrief">
                    AWS IoT Device Shadow library
                </div>
            </td>
        </tr>
        <tr>
            <td id="returntomain">
                <a href="../main/index.html">Return to main page &uarr;</a>
            </td>
        </tr>
    </tbody>
    </table>
    </div>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('shadow_function_getasync.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">AwsIotShadow_GetAsync </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Retrieve a Thing Shadow and receive an asynchronous notification when the Shadow document is received.</p>
<div class="fragment"><div class="line"><a class="code" href="group__shadow__datatypes__enums.html#ga2ff0365cc9f00ac61c735b884331580d">AwsIotShadowError_t</a> <a class="code" href="aws__iot__shadow_8h.html#aa263c0f9188f44f63240da141fbd61fc">AwsIotShadow_GetAsync</a>( <a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/mqtt.tag:../mqtt/" href="../mqtt/group__mqtt__datatypes__handles.html#ga4780ec2a55c4c322e9f5b7ce9dec3cf7">IotMqttConnection_t</a> mqttConnection,</div><div class="line">                                           <span class="keyword">const</span> <a class="code" href="structAwsIotShadowDocumentInfo__t.html">AwsIotShadowDocumentInfo_t</a> * pGetInfo,</div><div class="line">                                           uint32_t flags,</div><div class="line">                                           <span class="keyword">const</span> <a class="code" href="structAwsIotShadowCallbackInfo__t.html">AwsIotShadowCallbackInfo_t</a> * pCallbackInfo,</div><div class="line">                                           <a class="code" href="group__shadow__datatypes__handles.html#ga6bea7f19c374b5272b9ab7897234d7c5">AwsIotShadowOperation_t</a> * <span class="keyword">const</span> pGetOperation );</div></div><!-- fragment --><p>This function retrieves the Thing Shadow document currently stored by the Shadow service. If a given Thing has no Shadow and this function is called, the result will be <a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580da28e34d59a8f6f97f59f2b96caebfc89c" title="Shadow operation rejected: Thing not found. ">AWS_IOT_SHADOW_NOT_FOUND</a>.</p>
<p>Shadow documents may be large, and their size is not known beforehand. Therefore, this function works best when memory is dynamically allocated. Because the Shadow document is retrieved in an MQTT PUBLISH packet, the MQTT library will allocate a buffer for the Shadow document using <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/mqtt.tag:../mqtt/" href="../mqtt/iot__mqtt__internal_8h.html#a6cfc75d639424bc52deb2c63d0cfb136">IotMqtt_MallocMessage</a>.</p>
<p>The MQTT library may free the buffer for a retrieved Shadow document as soon as the <a class="el" href="structAwsIotShadowCallbackInfo__t.html">Shadow completion callback</a> returns. Therefore, any data needed later must be copied from the Shadow document. Similarly, if the flag <a class="el" href="aws__iot__shadow__types_8h.html#a936ad77bc6564d0e8fee7adf671d4aee" title="Allows the use of AwsIotShadow_Wait for blocking until completion. ">AWS_IOT_SHADOW_FLAG_WAITABLE</a> is given to this function (which indicates that the Shadow document will be needed after the Shadow operation completes), <a class="el" href="structAwsIotShadowDocumentInfo__t.html#ad06193fe2d653c76f0b7bfc8c3f7df94" title="Function to allocate memory for an incoming Shadow document. ">AwsIotShadowDocumentInfo_t.mallocDocument</a> must be provided to allocate a longer-lasting buffer.</p>
<dl class="section note"><dt>Note</dt><dd>Because of the potentially large size of complete Shadow documents, it is more memory-efficient for most applications to use <a class="el" href="shadow_function_setdeltacallback.html">delta callbacks</a> to retrieve Shadows from the Shadow service.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mqttConnection</td><td>The MQTT connection to use for Shadow get. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pGetInfo</td><td>Shadow document parameters. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Flags which modify the behavior of this function. See <a class="el" href="shadow_constants.html#shadow_constants_flags">Shadow Function Flags</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pCallbackInfo</td><td>Asynchronous notification of this function's completion. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pGetOperation</td><td>Set to a handle by which this operation may be referenced after this function returns. This reference is invalidated once the Shadow get completes.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function will return <a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580da46899c74ca9b0b1f72746e17af3bdf04" title="Shadow operation queued, awaiting result. ">AWS_IOT_SHADOW_STATUS_PENDING</a> upon successfully queuing a Shadow get. </dd>
<dd>
If this function fails before queuing a Shadow get, it will return one of:<ul>
<li><a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580daff9618ab3eaed18259869e9af734ba4d" title="An API function was called before AwsIotShadow_Init. ">AWS_IOT_SHADOW_NOT_INITIALIZED</a></li>
<li><a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580dab185937dbdc1f9ccbdbdd2f34fc2dea0" title="At least one parameter is invalid. ">AWS_IOT_SHADOW_BAD_PARAMETER</a></li>
<li><a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580daebd5e31e2dfaac6dbb376c4852c0b41a" title="Shadow operation failed because of memory allocation failure. ">AWS_IOT_SHADOW_NO_MEMORY</a> </li>
</ul>
</dd>
<dd>
Upon successful completion of the Shadow get (either through an <a class="el" href="structAwsIotShadowCallbackInfo__t.html" title="Information on a user-provided Shadow callback function. ">AwsIotShadowCallbackInfo_t</a> or <a class="el" href="aws__iot__shadow_8h.html#a4c256d388abf0db285d01c8c7a42a0cc" title="Wait for a Shadow operation to complete. ">AwsIotShadow_Wait</a>), the status will be <a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580da25e45d9e48f64daac9ad2205654087c5" title="Shadow operation completed successfully. ">AWS_IOT_SHADOW_SUCCESS</a>. </dd>
<dd>
Should the Shadow get fail, the status will be one of:<ul>
<li><a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580daebd5e31e2dfaac6dbb376c4852c0b41a" title="Shadow operation failed because of memory allocation failure. ">AWS_IOT_SHADOW_NO_MEMORY</a> (Memory could not be allocated for incoming document)</li>
<li><a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580da143efc7ed6d140da56198573a18fcc06" title="Shadow operation failed because of failure in MQTT library. ">AWS_IOT_SHADOW_MQTT_ERROR</a></li>
<li><a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580dab9154f8d0e8a52c868e8f601fb164960" title="Response received from Shadow service not understood. ">AWS_IOT_SHADOW_BAD_RESPONSE</a></li>
<li>A Shadow service rejection reason between 400 (<a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580daa7723c8df51cd24d3821b8f1286d715a" title="Shadow operation rejected: Bad request. ">AWS_IOT_SHADOW_BAD_REQUEST</a>) and 500 (<a class="el" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580da49ceecba1338711526bf8cf81664a880" title="Shadow operation rejected: Internal service failure. ">AWS_IOT_SHADOW_SERVER_ERROR</a>)</li>
</ul>
</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="shadow_function_getsync.html">AwsIotShadow_GetSync</a> for a blocking variant of this function.</dd></dl>
<p><b>Example</b> </p><div class="fragment"><div class="line"><span class="comment">// Shadow get completion callback. The retrieved document will be in</span></div><div class="line"><span class="comment">// pCallbackParam. Any data in the retrieved document needed after this</span></div><div class="line"><span class="comment">// function returns must be copied.</span></div><div class="line"><span class="keywordtype">void</span> _processRetrievedDocument( <span class="keywordtype">void</span> * pCallbackContext,</div><div class="line">                                <a class="code" href="structAwsIotShadowCallbackParam__t.html">AwsIotShadowCallbackParam_t</a> * pCallbackParam );</div><div class="line"></div><div class="line"><span class="comment">// Parameters and return value of Shadow get.</span></div><div class="line"><a class="code" href="group__shadow__datatypes__enums.html#ga2ff0365cc9f00ac61c735b884331580d">AwsIotShadowError_t</a> result = <a class="code" href="group__shadow__datatypes__enums.html#gga2ff0365cc9f00ac61c735b884331580da46899c74ca9b0b1f72746e17af3bdf04">AWS_IOT_SHADOW_STATUS_PENDING</a>;</div><div class="line"><a class="code" href="structAwsIotShadowDocumentInfo__t.html">AwsIotShadowDocumentInfo_t</a> getInfo = { ... };</div><div class="line">uint32_t timeout = 5000; <span class="comment">// 5 seconds</span></div><div class="line"></div><div class="line"><span class="comment">// Callback for get completion.</span></div><div class="line"><a class="code" href="structAwsIotShadowCallbackInfo__t.html">AwsIotShadowCallbackInfo_t</a> getCallback = <a class="code" href="aws__iot__shadow__types_8h.html#ab23cd11c4ca278342eade8ca1f631144">AWS_IOT_SHADOW_CALLBACK_INFO_INITIALIZER</a>;</div><div class="line">getCallback.<a class="code" href="structAwsIotShadowCallbackInfo__t.html#af5e7a55fe0ffb51a67363d2295077c84">function</a> = _processRetrievedDocument;</div><div class="line"></div><div class="line"><span class="comment">// Shadow get operation.</span></div><div class="line">result = <a class="code" href="aws__iot__shadow_8h.html#aa263c0f9188f44f63240da141fbd61fc">AwsIotShadow_GetAsync</a>( mqttConnection,</div><div class="line">                                &amp;getInfo,</div><div class="line">                                0,</div><div class="line">                                &amp;getCallback,</div><div class="line">                                NULL );</div><div class="line"></div><div class="line"><span class="comment">// Get should have returned AWS_IOT_SHADOW_STATUS_PENDING. The function</span></div><div class="line"><span class="comment">// _processRetrievedDocument will be invoked once the Shadow get completes.</span></div></div><!-- fragment --><p>See <a class="el" href="shadow_function_wait.html">AwsIotShadow_Wait</a> <b>Example 2</b> for an example of using this function with <a class="el" href="aws__iot__shadow__types_8h.html#a936ad77bc6564d0e8fee7adf671d4aee" title="Allows the use of AwsIotShadow_Wait for blocking until completion. ">AWS_IOT_SHADOW_FLAG_WAITABLE</a> and <a class="el" href="shadow_function_wait.html">AwsIotShadow_Wait</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- This file provides the custom footer for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14
    </li>
    <li class="footer">
      Last updated Thu Apr 30 2020
    </li>
    <li class="footer" style="float:left">
        SDK version 4.0.0b1
    </li>
  </ul>
</div>
</body>
</html>
