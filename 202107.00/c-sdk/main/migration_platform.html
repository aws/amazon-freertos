<!-- This file provides the custom header for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
        Main: Platform layer
    </title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="foobar.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
    <tbody>
        <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">
                    <span id="csdkprefix">AWS IoT Device SDK C:</span>
                    Main
                </div>
            </td>
        </tr>
        <tr>
            <td id="returntomain">
                <a href="../main/index.html">Return to main page &uarr;</a>
            </td>
        </tr>
    </tbody>
    </table>
    </div>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('migration_platform.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Platform layer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>How to migrate the platform layer from v3 to v4.</p>
<p>The platform layer provides portability across different operating systems. Both v3 and v4 provide a POSIX port as an example. If you are running on a v3 application on a POSIX system, you can switch the to provided v4 POSIX port and skip this page. This guide is intended for applications running on other operating systems that would like to move their porting layer from v3 to v4.</p>
<h1><a class="anchor" id="migration_platform_mutex"></a>
Mutex</h1>
<p>How to migrate the mutex type from v3 to v4.</p>
<p>The mutexes used in v3 and v4 implement the same interface. In v4, recursive mutexes must be supported.</p>
<p>The table below shows the equivalent mutex types for v3 and v4.</p>
<table class="doxtable">
<tr>
<th></th><th>Version 3 </th><th>Version 4 </th><th>Notes  </th></tr>
<tr>
<td>Name </td><td>struct _IoT_Mutex_t </td><td>_IotSystemMutex_t </td><td>In v3, the mutex type must be a struct.<br />
In v4, the mutex type may be any type.  </td></tr>
<tr>
<td>Declare in file </td><td>threads_platform.h </td><td>iot_config.h </td><td>In v3, the mutex type <em>must</em> be declared in a file called threads_platform.h. <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/0da87f06f1501fad7b03b5d89a1322cc8a8848b4/platform/linux/pthread/threads_platform.h">Link to sample</a> <br />
 In v4, we recommend declaring the mutex type in iot_config.h.   </td></tr>
</table>
<h2><a class="anchor" id="migration_platform_mutex_interface"></a>
Interface</h2>
<p>Equivalent functions of the mutex interface between v3 and v4.</p>
<p>The following functions should be implemented for the mutex type:</p><ul>
<li>v3: See functions in <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/0da87f06f1501fad7b03b5d89a1322cc8a8848b4/include/threads_interface.h">threads_interface.h</a></li>
<li>v4: IotMutex functions in <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_threads_functions.html">Thread Management</a></li>
</ul>
<p>The table below shows the equivalent functions in v3 and v4.</p>
<table class="doxtable">
<tr>
<th>Version 3 </th><th>Version 4 </th><th>Notes  </th></tr>
<tr>
<td>aws_iot_thread_mutex_init </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_threads_function_mutexcreate.html">IotMutex_Create</a> </td><td>The v4 function must support recursive mutexes.  </td></tr>
<tr>
<td>aws_iot_thread_mutex_lock </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_threads_function_mutexlock.html">IotMutex_Lock</a> </td><td></td></tr>
<tr>
<td>aws_iot_thread_mutex_trylock </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_threads_function_mutextrylock.html">IotMutex_TryLock</a> </td><td></td></tr>
<tr>
<td>aws_iot_thread_mutex_unlock </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_threads_function_mutexunlock.html">IotMutex_Unlock</a> </td><td></td></tr>
<tr>
<td>aws_iot_thread_mutex_destroy </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_threads_function_mutexdestroy.html">IotMutex_Destroy</a> </td><td></td></tr>
</table>
<h2><a class="anchor" id="migration_platform_mutex_example"></a>
Example</h2>
<p>Example of migration between v3 and v4.</p>
<p>The table below provides examples of the equivalent mutex types and interfaces implemented on v3 and v4.</p>
<table class="doxtable">
<tr>
<th></th><th>Version 3 </th><th>Version 4  </th></tr>
<tr>
<td>Declaration </td><td><div class="fragment"><div class="line"><span class="comment">/* In threads_platform.h */</span></div><div class="line"><span class="keyword">struct </span>_IoT_Mutex_t {</div><div class="line">    pthread_mutex_t lock;</div><div class="line">};</div></div><!-- fragment -->  </td><td><div class="fragment"><div class="line"><span class="comment">/* In iot_config.h */</span></div><div class="line"><span class="keyword">typedef</span> pthread_mutex_t _IotSystemMutex_t;</div></div><!-- fragment -->   </td></tr>
<tr>
<td>Sample implementation (POSIX) </td><td><a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/0da87f06f1501fad7b03b5d89a1322cc8a8848b4/platform/linux/pthread/threads_pthread_wrapper.c">threads_pthread_wrapper.c</a> </td><td><a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/9de8d2a4277903225e72b05e2c4ea00badf9fd19/ports/posix/src/iot_threads_posix.c">iot_threads_posix.c</a>  </td></tr>
</table>
<h1><a class="anchor" id="migration_platform_timer"></a>
Timer</h1>
<p>Differences between v3 and v4 timers.</p>
<p>The timers in v4 are more efficient than v3, but their interface is completely different. In v4, the timer interface is designed to be similar to the timer APIs provided by most operating systems.</p>
<p>Because of the differences between the timers in v3 and v4, it is not possible to migrate a v3 timer implementation to v4. Therefore, a new timer implementation will need to be written for v4. See <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_clock_functions.html">Clock</a> for the list of functions that need to be implemented.</p>
<h1><a class="anchor" id="migration_platform_semaphore"></a>
Semaphores</h1>
<p>Details about counting semaphores needed in v4.</p>
<p>Counting semaphores are a new addition to the platform layer in v4. They were not present in v3. See the IotSemaphore functions in <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_threads_functions.html">Thread Management</a> for the list of functions that need to be implemented.</p>
<h1><a class="anchor" id="migration_platform_network"></a>
Networking</h1>
<p>How to migrate the network implementation from v3 to v4.</p>
<p>The networking functions are similar between v3 and v4. However, v4 requires some additional function to be implemented.</p>
<p>The networking component requires a type to provide credentials for secured connections. The table below shows the equivalent credentials type for v3 and v4.</p>
<table class="doxtable">
<tr>
<th></th><th>Version 3 </th><th>Version 4 </th><th>Notes  </th></tr>
<tr>
<td>Name </td><td>TLSDataParams </td><td>_IotNetworkCredentials_t </td><td>v4 provides <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkCredentials.html">IotNetworkCredentials</a> as a struct that satisfies most use cases.  </td></tr>
<tr>
<td>Declare in file </td><td>network_platform.h </td><td>iot_config.h </td><td>In v3, the credentials type <em>must</em> be declared in a file called network_platform.h. <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/0da87f06f1501fad7b03b5d89a1322cc8a8848b4/platform/linux/mbedtls/network_platform.h">Link to sample</a> <br />
 In v4, we recommend declaring the credentials type in iot_config.h.   </td></tr>
</table>
<p>Version 4 requires two additional types to be declared:</p><ul>
<li><code>_IotNetworkServerInfo_t</code> which provides data on the remote server. <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkServerInfo.html">IotNetworkServerInfo</a> should satisfy most use cases.</li>
<li><code>_IotNetworkConnection_t</code> to represent the handle of a network connection. This should be an opaque handle.</li>
</ul>
<h2><a class="anchor" id="migration_platform_networking_interface"></a>
Interface</h2>
<p>Equivalent functions of the networking interface between v3 and v4.</p>
<p>The following functions should be implemented for networking:</p><ul>
<li>v3: See functions in <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/0da87f06f1501fad7b03b5d89a1322cc8a8848b4/include/network_interface.h">network_interface.h</a></li>
<li>v4: Functions in <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_functions.html">Networking</a></li>
</ul>
<p>The table below shows the equivalent functions in v3 and v4.</p>
<table class="doxtable">
<tr>
<th>Version 3 </th><th>Version 4 </th><th>Notes  </th></tr>
<tr>
<td>iot_tls_init </td><td><em>Platform-specific init functions</em> </td><td>The v4 networking interface does not define a function that must be implemented to initialize the network, as some network stacks do not require initialization. It may be implemented if needed.<br />
<br />
 The parameters of iot_tls_init have been moved to <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_create.html">IotNetworkInterface_t::create</a>.   </td></tr>
<tr>
<td>iot_tls_connect </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_create.html">IotNetworkInterface_t::create</a> </td><td></td></tr>
<tr>
<td>iot_tls_write </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_send.html">IotNetworkInterface_t::send</a> </td><td></td></tr>
<tr>
<td>iot_tls_read </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_receive.html">IotNetworkInterface_t::receive</a> </td><td></td></tr>
<tr>
<td>iot_tls_disconnect </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_close.html">IotNetworkInterface_t::close</a> </td><td></td></tr>
<tr>
<td>iot_tls_destroy </td><td><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_destroy.html">IotNetworkInterface_t::destroy</a> </td><td>In v3, this function destroys the entire network stack.<br />
In v4, this function only destroys the connection passed to it.  </td></tr>
</table>
<p>Version 4 has the following new functions that must be implemented:</p><ul>
<li><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_setreceivecallback.html">IotNetworkInterface_t::setReceiveCallback</a></li>
<li><a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/platform_network_function_setclosecallback.html">IotNetworkInterface_t::setCloseCallback</a></li>
</ul>
<p>Version 4 requires the networking functions to be given as an <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkInterface__t.html">IotNetworkInterface_t</a>. We recommend implementing a function that returns the <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkInterface__t.html">IotNetworkInterface_t</a> containing the networking functions.</p>
<h2><a class="anchor" id="migration_platform_networking_example"></a>
Example</h2>
<p>Example of migration between v3 and v4.</p>
<p>The table below provides examples of the equivalent networking types and interfaces implemented on v3 and v4.</p>
<table class="doxtable">
<tr>
<th></th><th>Version 3 </th><th>Version 4  </th></tr>
<tr>
<td>Credentials type declaration </td><td><div class="fragment"><div class="line"><span class="comment">/* In threads_platform.h */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_TLSDataParams {</div><div class="line">    <span class="comment">/* Members omitted due to length. */</span></div><div class="line">} TLSDataParams;</div></div><!-- fragment -->  </td><td><div class="fragment"><div class="line"><span class="comment">/* In iot_config.h */</span></div><div class="line"></div><div class="line"><span class="comment">/* Forward declare standard type from v4. */</span></div><div class="line"><span class="keyword">struct </span><a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkCredentials.html">IotNetworkCredentials</a>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkCredentials.html">IotNetworkCredentials</a> * _IotNetworkCredentials_t;</div></div><!-- fragment -->   </td></tr>
<tr>
<td>Server info declaration </td><td><em>None</em> </td><td><div class="fragment"><div class="line"><span class="comment">/* In iot_config.h */</span></div><div class="line"></div><div class="line"><span class="comment">/* Forward declare standard type from v4. */</span></div><div class="line"><span class="keyword">struct </span><a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkServerInfo.html">IotNetworkServerInfo</a>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="codeRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/platform.tag:../platform/" href="../platform/structIotNetworkServerInfo.html">IotNetworkServerInfo</a> * _IotNetworkServerInfo_t;</div></div><!-- fragment -->   </td></tr>
<tr>
<td>Opaque network type declaration </td><td><em>None</em> </td><td><div class="fragment"><div class="line"><span class="comment">/* In iot_config.h */</span></div><div class="line"></div><div class="line"><span class="comment">/* Forward declare opaque struct. */</span></div><div class="line"><span class="keyword">struct </span>_networkConnection;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_networkConnection * _IotNetworkConnection_t;</div></div><!-- fragment -->   </td></tr>
<tr>
<td>Sample implementation (mbed TLS) </td><td><a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/0da87f06f1501fad7b03b5d89a1322cc8a8848b4/platform/linux/mbedtls/network_mbedtls_wrapper.c">network_mbedtls_wrapper.c</a> </td><td><a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/blob/706daad20b4d810704ba5929786dd8f30ab1105f/ports/common/src/iot_network_mbedtls.c">iot_network_mbedtls.c</a>  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- This file provides the custom footer for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14
    </li>
    <li class="footer">
      Last updated Thu Apr 30 2020
    </li>
    <li class="footer" style="float:left">
        SDK version 4.0.0b1
    </li>
  </ul>
</div>
</body>
</html>
