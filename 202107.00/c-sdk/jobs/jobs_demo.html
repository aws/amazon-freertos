<!-- This file provides the custom header for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>
        Jobs: Demo
    </title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="foobar.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
    <tbody>
        <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">
                    <span id="csdkprefix">AWS IoT Device SDK C:</span>
                    Jobs
                </div>
                <div id="projectbrief">
                    AWS IoT Jobs library
                </div>
            </td>
        </tr>
        <tr>
            <td id="returntomain">
                <a href="../main/index.html">Return to main page &uarr;</a>
            </td>
        </tr>
    </tbody>
    </table>
    </div>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('jobs_demo.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Demo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Demonstrates the usage of the Jobs library.</p>
<p>This demo provides a simple example on using the Jobs library and working with AWS IoT Jobs.</p>
<p>The Jobs demo establishes an MQTT connection and registers a <a class="el" href="jobs_function_setnotifynextcallback.html">Jobs NotifyNext callback</a>. It then waits for new Jobs. When a Job arrives, the demo parses the Job document and takes action based on the document content.</p>
<h1><a class="anchor" id="jobs_demo_setup"></a>
Demo Setup</h1>
<p>How to set up Jobs for the Jobs demo.</p>
<p>Because the Jobs MQTT API does not support creating Jobs, you must create Jobs for the demo separately. We recommend using AWS CLI to create Jobs.</p>
<ol type="1">
<li>Create a user for AWS CLI. See steps 1 and 2 of <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/main.tag:../main/" href="../main/guide_developer_automated_tests.html#guide_developer_automated_tests_jobs_and_provisioning">Additional Travis CI setup for Jobs and Provisioning system tests</a> for more information.</li>
<li>Build and run the demo as described <a class="elRef" doxygen="/home/ubuntu/Repos/aws-iot-device-sdk-embedded-C/doc/tag/main.tag:../main/" href="../main/building.html">here</a>.</li>
<li>When the following message appears, you may begin creating Jobs for the demo. <div class="fragment"><div class="line">/*-----------------------------------------------------------*/</div><div class="line"></div><div class="line">The Jobs demo is now ready to accept Jobs.</div><div class="line">Jobs may be created using the AWS IoT console or AWS CLI.</div><div class="line">See the following link for more information.</div><div class="line"></div><div class="line">https://docs.aws.amazon.com/cli/latest/reference/iot/create-job.html</div><div class="line"></div><div class="line">This demo expects Job documents to have an &quot;action&quot; JSON key.</div><div class="line">The following actions are currently supported:</div><div class="line"> - print</div><div class="line">   Logs a message to the local console. The Job document must also contain a &quot;message&quot;.</div><div class="line">   For example: { &quot;action&quot;: &quot;print&quot;, &quot;message&quot;: &quot;Hello world!&quot;} will cause</div><div class="line">   &quot;Hello world!&quot; to be printed on the console.</div><div class="line"> - publish</div><div class="line">   Publishes a message to an MQTT topic. The Job document must also contain a &quot;message&quot; and &quot;topic&quot;.</div><div class="line">   For example: { &quot;action&quot;: &quot;publish&quot;, &quot;topic&quot;: &quot;demo/jobs&quot;, &quot;message&quot;: &quot;Hello world!&quot;} will cause</div><div class="line">   &quot;Hello world!&quot; to be published to the topic &quot;demo/jobs&quot;.</div><div class="line"> - exit</div><div class="line">   Exits the demo program. This program will run until { &quot;action&quot;: &quot;exit&quot; } is received.</div><div class="line"></div><div class="line">/*-----------------------------------------------------------*/</div></div><!-- fragment --></li>
</ol>
<p>The supported actions are described above. As an example, the command to create a "publish" Job with AWS CLI is below. Replace <code>UniqueId</code> with a Job ID that is unique, and <code>ThingARN</code> with the ARN of the target Thing.</p>
<div class="fragment"><div class="line">aws iot create-job \</div><div class="line">        --job-id UniqueId \</div><div class="line">        --targets ThingARN \</div><div class="line">        --document &#39;{&quot;action&quot;:&quot;publish&quot;,&quot;message&quot;:&quot;Hello world!&quot;,&quot;topic&quot;:&quot;jobsdemo/1&quot;}&#39;</div></div><!-- fragment --><p>This will cause the Jobs demo to publish the message <code>Hello world!</code> on the topic <code>jobsdemo/1</code>. You may view this message by subscribing to the topic in AWS IoT Console.</p>
<p>When the demo finishes with a Job, it will mark the Jobs as complete. Note that completed Jobs are not automatically removed from the AWS IoT Console. The following command can be used to remove completed Jobs. Replace <code>UniqueId</code> with the Job ID.</p>
<div class="fragment"><div class="line">aws iot delete-job --job-id UniqueId</div></div><!-- fragment --><h1>Demo Structure</h1>
<p>The Jobs demo uses the <em>asynchronous</em> API of the Jobs library. Most of the demo is run from the NotifyNext callback.</p>
<div class="image">
<img src="jobs_demo.png" alt="jobs_demo.png" width="80%"/>
<div class="caption">
Jobs Demo Execution Sequence</div></div>
<dl class="section note"><dt>Note</dt><dd>Messages from the Jobs service (which are sent at MQTT QoS 1) may be received multiple times. The Jobs NotifyNext callback must be able to handle duplicated Job documents. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- This file provides the custom footer for Doxygen-generated HTML. Per the
Doxygen documentation, this file may need to be regenerated when Doxygen is
updated. -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14
    </li>
    <li class="footer">
      Last updated Thu Apr 30 2020
    </li>
    <li class="footer" style="float:left">
        SDK version 4.0.0b1
    </li>
  </ul>
</div>
</body>
</html>
