<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>coreMQTT Agent: Message Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="foobar.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">coreMQTT Agent<span id="projectnumber">&#160;v1.0.0</span>
   </div>
   <div id="projectbrief">Thread safe MQTT 3.1.1 Client</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mqtt_agent_message_interface.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Message Interface </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Messaging interface used by the MQTT Agent.<br  />
<br  />
</p>
<h1><a class="anchor" id="mqtt_agent_message_interface_overview"></a>
Message Interface Overview</h1>
<p >The message interface is a set of APIs to send MQTT Agent commands from application tasks to the MQTT agent task, as well as functions to allocate and release storage for these commands. It must be implemented with thread safety, as multiple tasks can send commands concurrently. The message interface is defined in <a class="el" href="core__mqtt__agent__message__interface_8h.html">core_mqtt_agent_message_interface.h</a>.<br  />
</p>
<p >The functions that must be implemented are:<br  />
</p><ul>
<li><a class="el" href="core__mqtt__agent__message__interface_8h.html#a253db91729e7d75433785b9f45a4e26e">Message Send</a></li>
<li><a class="el" href="core__mqtt__agent__message__interface_8h.html#ad723bb4fba6cec8bf69c039c0d34a824">Message Receive</a></li>
<li><a class="el" href="core__mqtt__agent__message__interface_8h.html#a61db0a5f8ea9119d86cf7b0c2b4cb8d2">Get Command</a></li>
<li><a class="el" href="core__mqtt__agent__message__interface_8h.html#a1acc4e89dd0f33c7fecf24555abc5cc4">Release Command</a></li>
</ul>
<p >The send and receive functions take in an opaque context <a class="el" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a>. The functions above and the context are grouped together in the <a class="el" href="struct_m_q_t_t_agent_message_interface__t.html">MQTTAgentMessageInterface_t</a> structure:<br  />
 </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>MQTTAgentMessageInterface</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a> * pMsgCtx;      </div>
<div class="line">    <a class="code" href="core__mqtt__agent__message__interface_8h.html#a253db91729e7d75433785b9f45a4e26e">MQTTAgentMessageSend_t</a> send;              </div>
<div class="line">    <a class="code" href="core__mqtt__agent__message__interface_8h.html#ad723bb4fba6cec8bf69c039c0d34a824">MQTTAgentMessageRecv_t</a> recv;              </div>
<div class="line">    <a class="code" href="core__mqtt__agent__message__interface_8h.html#a61db0a5f8ea9119d86cf7b0c2b4cb8d2">MQTTAgentCommandGet_t</a> getCommand;         </div>
<div class="line">    <a class="code" href="core__mqtt__agent__message__interface_8h.html#a1acc4e89dd0f33c7fecf24555abc5cc4">MQTTAgentCommandRelease_t</a> releaseCommand; </div>
<div class="line">} <a class="code" href="struct_m_q_t_t_agent_message_interface__t.html">MQTTAgentMessageInterface_t</a>;</div>
<div class="ttc" id="acore__mqtt__agent__message__interface_8h_html_a1acc4e89dd0f33c7fecf24555abc5cc4"><div class="ttname"><a href="core__mqtt__agent__message__interface_8h.html#a1acc4e89dd0f33c7fecf24555abc5cc4">MQTTAgentCommandRelease_t</a></div><div class="ttdeci">bool(* MQTTAgentCommandRelease_t)(MQTTAgentCommand_t *pCommandToRelease)</div><div class="ttdoc">Give a MQTTAgentCommand_t structure back to the application.</div><div class="ttdef"><b>Definition:</b> core_mqtt_agent_message_interface.h:117</div></div>
<div class="ttc" id="acore__mqtt__agent__message__interface_8h_html_a253db91729e7d75433785b9f45a4e26e"><div class="ttname"><a href="core__mqtt__agent__message__interface_8h.html#a253db91729e7d75433785b9f45a4e26e">MQTTAgentMessageSend_t</a></div><div class="ttdeci">bool(* MQTTAgentMessageSend_t)(MQTTAgentMessageContext_t *pMsgCtx, MQTTAgentCommand_t *const *pCommandToSend, uint32_t blockTimeMs)</div><div class="ttdoc">Send a message to the specified context. Must be thread safe.</div><div class="ttdef"><b>Definition:</b> core_mqtt_agent_message_interface.h:62</div></div>
<div class="ttc" id="acore__mqtt__agent__message__interface_8h_html_a61db0a5f8ea9119d86cf7b0c2b4cb8d2"><div class="ttname"><a href="core__mqtt__agent__message__interface_8h.html#a61db0a5f8ea9119d86cf7b0c2b4cb8d2">MQTTAgentCommandGet_t</a></div><div class="ttdeci">MQTTAgentCommand_t *(* MQTTAgentCommandGet_t)(uint32_t blockTimeMs)</div><div class="ttdoc">Obtain a MQTTAgentCommand_t structure.</div><div class="ttdef"><b>Definition:</b> core_mqtt_agent_message_interface.h:99</div></div>
<div class="ttc" id="acore__mqtt__agent__message__interface_8h_html_ad723bb4fba6cec8bf69c039c0d34a824"><div class="ttname"><a href="core__mqtt__agent__message__interface_8h.html#ad723bb4fba6cec8bf69c039c0d34a824">MQTTAgentMessageRecv_t</a></div><div class="ttdeci">bool(* MQTTAgentMessageRecv_t)(MQTTAgentMessageContext_t *pMsgCtx, MQTTAgentCommand_t **pReceivedCommand, uint32_t blockTimeMs)</div><div class="ttdoc">Receive a message from the specified context. Must be thread safe.</div><div class="ttdef"><b>Definition:</b> core_mqtt_agent_message_interface.h:78</div></div>
<div class="ttc" id="agroup__mqtt__agent__struct__types_html_ga3c47f2ebcec2e1150e40d039639e5a3b"><div class="ttname"><a href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a></div><div class="ttdeci">struct MQTTAgentMessageContext MQTTAgentMessageContext_t</div><div class="ttdoc">Context with which tasks may deliver messages to the agent.</div><div class="ttdef"><b>Definition:</b> core_mqtt_agent_message_interface.h:48</div></div>
<div class="ttc" id="astruct_m_q_t_t_agent_message_interface__t_html"><div class="ttname"><a href="struct_m_q_t_t_agent_message_interface__t.html">MQTTAgentMessageInterface_t</a></div><div class="ttdoc">Function pointers and contexts used for sending and receiving commands, and allocating memory for the...</div><div class="ttdef"><b>Definition:</b> core_mqtt_agent_message_interface.h:127</div></div>
</div><!-- fragment --><p><br  />
</p>
<h1><a class="anchor" id="mqtt_agent_message_interface_implement"></a>
Implementing the Message Interface</h1>
<p >The following steps give guidance on implementing the messaging interface:<br  />
</p>
<ol type="1">
<li>Implementing <a class="el" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t<br  />
</a><br  />
 <div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>MQTTAgentMessageContext   <a class="code" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a>;</div>
</div><!-- fragment --><br  />
 <a class="el" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a> is the incomplete type <b>struct MQTTAgentMessageContext</b>. The implemented struct MQTTAgentMessageContext must contain all of the information needed to send and receive commands with <a class="el" href="core__mqtt__agent__message__interface_8h.html#a253db91729e7d75433785b9f45a4e26e">MQTTAgentMessageSend_t</a> and <a class="el" href="core__mqtt__agent__message__interface_8h.html#ad723bb4fba6cec8bf69c039c0d34a824">MQTTAgentMessageRecv_t</a> with thread safety. For example, this may be a handle to a thread safe queue, or a queue along with synchronization primitives. Commands are sent by pointer, so this structure should be able to relay pointers of type <a class="el" href="struct_m_q_t_t_agent_command.html">MQTTAgentCommand_t</a>.<br  />
<br  />
 <b>Example code:</b> <div class="fragment"><div class="line"><span class="keyword">struct </span>MQTTAgentMessageContext</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Queue holding MQTTAgentCommand_t * pointers.</span></div>
<div class="line">    Queue_t queue;</div>
<div class="line">};</div>
</div><!-- fragment --> <br  />
</li>
<li>Implementing <a class="el" href="core__mqtt__agent__message__interface_8h.html#a253db91729e7d75433785b9f45a4e26e">MQTTAgentMessageSend_t<br  />
</a><br  />
 <div class="fragment"><div class="line"><span class="keyword">typedef</span> bool ( * <a class="code" href="core__mqtt__agent__message__interface_8h.html#a253db91729e7d75433785b9f45a4e26e">MQTTAgentMessageSend_t</a> )( <a class="code" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a> * pMsgCtx,</div>
<div class="line">                                           MQTTAgentCommand_t * <span class="keyword">const</span> * pCommandToSend,</div>
<div class="line">                                           uint32_t blockTimeMs );</div>
</div><!-- fragment --><br  />
 This function is expected to send the pointer that is pointed to by <b>pCommandToSend</b> using the message context. It will return <code>true</code> if the send was successful, else <code>false</code>.<br  />
<br  />
 <b>Example code:</b> <div class="fragment"><div class="line"><span class="keywordtype">bool</span> myMessageSendImplementation( <a class="code" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a> * pMsgCtx,</div>
<div class="line">                                  MQTTAgentCommand_t * <span class="keyword">const</span> * pCommandToSend,</div>
<div class="line">                                  uint32_t blockTimeMs )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> status = EXIT_FAILURE;</div>
<div class="line">    <span class="keywordflow">if</span>( ( pMsgCtx != NULL ) &amp;&amp; ( pCommandToSend != NULL ) )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//A function to send data to via pointer to a queue.</span></div>
<div class="line">        status = Queue_SendToBack( pMsgCtx-&gt;queue, pCommandToSend, blockTimeMs );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> ( status == EXIT_SUCCESS );</div>
<div class="line">}</div>
</div><!-- fragment --> <br  />
</li>
<li>Implementing <a class="el" href="core__mqtt__agent__message__interface_8h.html#ad723bb4fba6cec8bf69c039c0d34a824">MQTTAgentMessageRecv_t<br  />
</a><br  />
 <div class="fragment"><div class="line"><span class="keyword">typedef</span> bool ( * <a class="code" href="core__mqtt__agent__message__interface_8h.html#ad723bb4fba6cec8bf69c039c0d34a824">MQTTAgentMessageRecv_t</a> )( <a class="code" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a> * pMsgCtx,</div>
<div class="line">                                           MQTTAgentCommand_t ** pReceivedCommand,</div>
<div class="line">                                           uint32_t blockTimeMs );</div>
</div><!-- fragment --><br  />
 This function is expected to receive a pointer that has been previously sent to the message context, and return in via the <b>pReceivedCommand</b> parameter. It will return <code>true</code> if the receive was successful, else <code>false</code>.<br  />
<br  />
 <b>Example code:</b> <div class="fragment"><div class="line"><span class="keywordtype">bool</span> myMessageRecvImplementation( <a class="code" href="group__mqtt__agent__struct__types.html#ga3c47f2ebcec2e1150e40d039639e5a3b">MQTTAgentMessageContext_t</a> * pMsgCtx,</div>
<div class="line">                                  MQTTAgentCommand_t ** pReceivedCommand,</div>
<div class="line">                                  uint32_t blockTimeMs )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> status = EXIT_FAILURE;</div>
<div class="line">    <span class="keywordtype">void</span> * pReceivedPointer;</div>
<div class="line">    <span class="keywordflow">if</span>( ( pMsgCtx != NULL ) &amp;&amp; ( pCommandToSend != NULL ) )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//A function to receive data from a queue.</span></div>
<div class="line">        status = Queue_Recv( pMsgCtx-&gt;queue, &amp;pReceivedPointer, blockTimeMs );</div>
<div class="line">        <span class="keywordflow">if</span>( status == EXIT_SUCCESS )</div>
<div class="line">        {</div>
<div class="line">            *pReceivedCommand = ( MQTTAgentCommand_t * ) pReceivedPointer;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> ( status == EXIT_SUCCESS );</div>
<div class="line">}</div>
</div><!-- fragment --> <br  />
</li>
<li>Implementing <a class="el" href="core__mqtt__agent__message__interface_8h.html#a61db0a5f8ea9119d86cf7b0c2b4cb8d2">MQTTAgentCommandGet_t<br  />
</a><br  />
 <div class="fragment"><div class="line"><span class="keyword">typedef</span> MQTTAgentCommand_t * ( * MQTTAgentCommandGet_t )( uint32_t blockTimeMs );</div>
</div><!-- fragment --><br  />
 This function is expected to allocate storage for an <a class="el" href="struct_m_q_t_t_agent_command.html">MQTTAgentCommand_t</a> struct. This function must be thread safe. It will return a pointer to the allocated command, or <code>NULL</code> if allocation failed.<br  />
<br  />
 <b>Example code:</b> <div class="fragment"><div class="line">MQTTAgentCommand_t * myGetCommandImplementation( uint32_t blockTimeMs )</div>
<div class="line">{</div>
<div class="line">    MQTTAgentCommand_t * ret = ( MQTTAgentCommand_t * ) malloc( <span class="keyword">sizeof</span>( MQTTAgentCommand_t ) );</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment --> <br  />
</li>
<li>Implementing <a class="el" href="core__mqtt__agent__message__interface_8h.html#a1acc4e89dd0f33c7fecf24555abc5cc4">MQTTAgentCommandRelease_t<br  />
</a><br  />
 <div class="fragment"><div class="line"><span class="keyword">typedef</span> bool ( * <a class="code" href="core__mqtt__agent__message__interface_8h.html#a1acc4e89dd0f33c7fecf24555abc5cc4">MQTTAgentCommandRelease_t</a> )( MQTTAgentCommand_t * pCommandToRelease );</div>
</div><!-- fragment --><br  />
 This function will release a <a class="el" href="struct_m_q_t_t_agent_command.html">MQTTAgentCommand_t</a> struct that had been allocated with <a class="el" href="core__mqtt__agent__message__interface_8h.html#a61db0a5f8ea9119d86cf7b0c2b4cb8d2">MQTTAgentCommandGet_t</a>. It will return a <code>true</code> if the command was release, else <code>false</code>.<br  />
<br  />
 <b>Example code:</b> <div class="fragment"><div class="line"><span class="keywordtype">bool</span> myReleaseCommandImplementation( MQTTAgentCommand_t * pCommandToRelease )</div>
<div class="line">{</div>
<div class="line">    free( pCommandToRelease );</div>
<div class="line">    <span class="comment">//free() does not have a return value.</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> <br  />
 </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
