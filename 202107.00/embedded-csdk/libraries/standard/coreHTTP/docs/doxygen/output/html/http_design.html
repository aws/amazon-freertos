<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>coreHTTP: Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="foobar.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">coreHTTP<span id="projectnumber">&#160;v2.0.0</span>
   </div>
   <div id="projectbrief">HTTP/1.1 Client Library</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('http_design.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Design </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >HTTP Client Library Architecture and Design</p>
<p >This HTTP client library implements a subset of the HTTP/1.1 protocol. It is optimized for resource constrained devices and does not dynamically allocate any memory.</p>
<h1><a class="anchor" id="http_transport_interface_blurb"></a>
Transport Interface</h1>
<p >For decoupling from the user platform, the HTTP client library uses a transport interface. The transport interface allows the HTTP client library to send and receive data over the user's transport layer. The user platform must implement a <a class="el" href="struct_transport_interface__t.html">TransportInterface_t</a> to use in <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a>.</p>
<dl class="section see"><dt>See also</dt><dd>The <a class="el" href="http_transport_interface.html">transport interface documentation</a> for more information.</dd></dl>
<h1><a class="anchor" id="http_request_serialization"></a>
Building an HTTP Request</h1>
<p >The HTTP client library provides the following API to serialize request headers.</p><ul>
<li><a class="el" href="core__http__client_8h.html#ab523c4d4e3b756928d463bd864361a9c">HTTPClient_InitializeRequestHeaders</a></li>
<li><a class="el" href="core__http__client_8h.html#a451c30912fcdf48c71f9144788250916">HTTPClient_AddHeader</a></li>
<li><a class="el" href="core__http__client_8h.html#af91c4a57452556db2be926743aa02b81">HTTPClient_AddRangeHeader</a></li>
</ul>
<p >An application is expected to create and populate an <a class="el" href="struct_h_t_t_p_request_info__t.html">HTTPRequestInfo_t</a> and set a buffer to use for the headers in <a class="el" href="struct_h_t_t_p_request_headers__t.html#acaffc0e3ae5413bf7c673f83388bc7c6">HTTPRequestHeaders_t::pBuffer</a>. The application may first call <a class="el" href="core__http__client_8h.html#ab523c4d4e3b756928d463bd864361a9c">HTTPClient_InitializeRequestHeaders</a> to populate the <a class="el" href="struct_h_t_t_p_request_headers__t.html">HTTPRequestHeaders_t</a> with the method, the path, and the host. The HTTP request will be serialized to the following when <a class="el" href="struct_h_t_t_p_request_info__t.html#a157ebe1394fe870d342b25a5521f2505" title="Flags to activate other request header configurations.">HTTPRequestInfo_t.reqFlags</a> is zero.</p>
<div class="fragment"><div class="line">&lt;METHOD&gt; &lt;PATH&gt; HTTP/1.1\r\n</div>
<div class="line">User-Agent: &lt;MY-PLATFORM&gt;\r\n</div>
<div class="line">Host: &lt;SERVER-URL&gt;\r\n\r\n</div>
</div><!-- fragment --><p >When the <a class="el" href="struct_h_t_t_p_request_info__t.html#a157ebe1394fe870d342b25a5521f2505">HTTPRequestInfo_t::reqFlags</a> has <a class="el" href="group__http__request__flags.html#gadec54e27d2d24006b4c22a7f945282de">HTTP_REQUEST_KEEP_ALIVE_FLAG</a> set, then the HTTP request will be serialized to the following:</p>
<div class="fragment"><div class="line">&lt;METHOD&gt; &lt;PATH&gt; HTTP/1.1\r\n</div>
<div class="line">User-Agent: &lt;MY-PLATFORM&gt;\r\n</div>
<div class="line">Host: &lt;SERVER-URL&gt;\r\n</div>
<div class="line">Connection: keep-alive\r\n\r\n</div>
</div><!-- fragment --><p >The user application may add more headers using <a class="el" href="core__http__client_8h.html#a451c30912fcdf48c71f9144788250916">HTTPClient_AddHeader</a> or <a class="el" href="core__http__client_8h.html#af91c4a57452556db2be926743aa02b81">HTTPClient_AddRangeHeader</a>. New headers will be appended to the end of the existing headers. Please see the following example:</p>
<div class="fragment"><div class="line">&lt;METHOD&gt; &lt;PATH&gt; HTTP/1.1\r\n</div>
<div class="line">User-Agent: &lt;MY-PLATFORM&gt;\r\n</div>
<div class="line">Host: &lt;SERVER-URL&gt;\r\n</div>
<div class="line">Connection: keep-alive\r\n</div>
<div class="line">Another-Header1: another-value1\r\n</div>
<div class="line">Another-Header2: another-value2\r\n</div>
<div class="line">Another-Header3: another-value3\r\n\r\n</div>
</div><!-- fragment --><p >The user application may pass a request body into the <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a> function when the request is ready to be sent.</p>
<h1><a class="anchor" id="http_range_support"></a>
HTTP Range Requests and Partial Content Responses</h1>
<p >Range Requests are strongly encouraged for downloading a large file. Large is defined here to be a file whose total size cannot fit into the space currently available in RAM. By downloading a large file using range requests the user application can spend time processing that part of the file (for example writing to flash), then request the next part of the file. If the user application were to request the entire file at once and process it in sections from the network, the system is at a high risk for dropping packets. Dropped packets cause retransmissions in the system's transport layer. With many, there can be a negative impact on the overall system throughput, network bandwidth, and battery life of the device.</p>
<p >Range requests are supported using <a class="el" href="core__http__client_8h.html#af91c4a57452556db2be926743aa02b81">HTTPClient_AddRangeHeader</a>. Please see the function documentation for more information.</p>
<h1><a class="anchor" id="http_response_deserialization"></a>
Receiving and Parsing an HTTP Response</h1>
<p >After the request headers are serialized, the user application must set a buffer to receive the HTTP response in <a class="el" href="struct_h_t_t_p_response__t.html#a8198002b2a936b784cd791560c1a3ca8">HTTPResponse_t::pBuffer</a>. <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a> is then used to send the request and receive the response. If the request has a body it is passed as a parameter to <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a>. As soon as the response is received from the network it is parsed. The final parsed response is represented by the <a class="el" href="struct_h_t_t_p_response__t.html">HTTPResponse_t</a> returned from <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a>. Parsing the HTTP response is done using <a href="https://github.com/nodejs/http-parser">http-parser</a>. http-parser invokes callbacks for each section in the HTTP response it finds. Using these callbacks the HTTP client library sets the members of <a class="el" href="struct_h_t_t_p_response__t.html">HTTPResponse_t</a> to return from <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a>. The overall flow of <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a> is shown in the activity diagram below:</p>
<div class="image">
<img src="httpclient_send_activity_diagram.png" alt="" width="50%"/>
</div>
<h1><a class="anchor" id="http_response_headers"></a>
Reading the HTTP Response Headers</h1>
<p >Upon a successful return from <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a>, the HTTP Response headers can be read from the headers found in <a class="el" href="struct_h_t_t_p_response__t.html#a88006d526bae430301bd668e6348e6ac">HTTPResponse_t::pHeaders</a>. The function <a class="el" href="core__http__client_8h.html#ac621a0756f290f1437e2c72a24e5b0f9">HTTPClient_ReadHeader</a> reads the headers from an <a class="el" href="struct_h_t_t_p_response__t.html">HTTPResponse_t</a>. <a class="el" href="core__http__client_8h.html#ac621a0756f290f1437e2c72a24e5b0f9">HTTPClient_ReadHeader</a> will re-parse the response in <a class="el" href="struct_h_t_t_p_response__t.html#a8198002b2a936b784cd791560c1a3ca8">HTTPResponse_t::pBuffer</a>, looking for the header field of interest. Re-parsing involves using http-parser to look at each character starting from the beginning of <a class="el" href="struct_h_t_t_p_response__t.html#a8198002b2a936b784cd791560c1a3ca8">HTTPResponse_t::pBuffer</a> until the header field of interest is found.</p>
<p >If the user application wants to avoid re-parsing <a class="el" href="struct_h_t_t_p_response__t.html#a8198002b2a936b784cd791560c1a3ca8">HTTPResponse_t::pBuffer</a>, then the user application may register a callback in <a class="el" href="struct_h_t_t_p_response__t.html#a0516505352424390934e765b2fed50ab">HTTPResponse_t::pHeaderParsingCallback</a>. When the HTTP response message is first received from the network, in <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a>, http-parser is invoked to parse the response. This first parsing in <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a> will invoke <a class="el" href="struct_h_t_t_p_response__t.html#a0516505352424390934e765b2fed50ab">HTTPResponse_t::pHeaderParsingCallback</a> for each header that is found in response. Please see the sequence diagram below for an illustration of when <a class="el" href="struct_h_t_t_p_client___response_header_parsing_callback__t.html#abed82645f6b2a8026b27dd6a6c0bcf30">HTTPClient_ResponseHeaderParsingCallback_t::onHeaderCallback</a> is invoked during the operation of <a class="el" href="core__http__client_8h.html#aa33b3334128496487d820f0da7ae5601">HTTPClient_Send</a>.</p>
<div class="image">
<img src="httpclient_send_sequence_diagram.png" alt="" width="50%"/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
