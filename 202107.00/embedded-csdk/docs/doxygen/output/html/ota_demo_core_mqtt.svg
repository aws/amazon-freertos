<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="7318.75px" preserveAspectRatio="none" style="width:3434px;height:7318px;" version="1.1" viewBox="0 0 3434 7318" width="3434.375px" zoomAndPan="magnify"><defs><filter height="300%" id="fytephofi9qg4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="6.25"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="12.5" dy="12.5" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFE4E1" height="7273.6221" style="stroke: #A80036; stroke-width: 3.125;" width="300" x="90.625" y="12.5"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240.625" x="120.3125" y="51.2009">Application</text><rect fill="#90EE90" height="7273.6221" style="stroke: #A80036; stroke-width: 3.125;" width="1010.9375" x="920.3125" y="12.5"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="259.375" x="1296.0938" y="51.2009">OTA Library</text><rect fill="#ADD8E6" height="7273.6221" style="stroke: #A80036; stroke-width: 3.125;" width="481.25" x="2089.0625" y="12.5"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="462.5" x="2098.4375" y="51.2009">Connectivity Libraries</text><rect fill="#E9967A" height="7273.6221" style="stroke: #A80036; stroke-width: 3.125;" width="334.375" x="3028.125" y="12.5"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="303.125" x="3037.5" y="51.2009">Cloud AWS IoT</text><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="3120.3125" y="98.4711">Service</text><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="1048.4924" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="461.8622"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="278.5202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="2097.1008"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="959.8068" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="2733.0566"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="182.0404" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="4176.0895"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="182.0404" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="4587.4405"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="530.4962" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="5359.3521"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="887.9318" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="6250.4089"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="240.625" y="6796.5302"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="229.3106" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="825.943"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="495.726" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="1419.3344"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="203.5202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="2281.871"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="184.7702" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="2824.0768"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="483.226" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="3692.8635"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="756.2866" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="4769.4809"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="3918.6539"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="367.2058" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="4992.1463"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="6159.3887"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="109.7702" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="6978.5706"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="461.8622"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="1146.2738"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="275.7904" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="1915.0604"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="184.7702" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="2733.0566"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="3175.2625"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="593.3914" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="4176.0895"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="5616.7877"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="455.101" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="6250.4089"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="552.8824"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="1237.294"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="1915.0604"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="3266.2827"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="229.3106" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="4358.1299"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="5707.8079"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="6523.4695"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="549.2462" style="stroke: #000000; stroke-width: 6.25;" width="3264.0625" x="71.875" y="3055.722"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="1880.1743" style="stroke: #000000; stroke-width: 6.25;" width="3326.5625" x="40.625" y="4056.5491"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="232.4356" style="stroke: #000000; stroke-width: 6.25;" width="565.625" x="1675" y="5039.0213"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="508.6212" style="stroke: #000000; stroke-width: 6.25;" width="3264.0625" x="71.875" y="5406.2271"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 5.0,5.0;" x1="240.625" x2="240.625" y1="229.8218" y2="7166.4658"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 5.0,5.0;" x1="1070.3125" x2="1070.3125" y1="229.8218" y2="7166.4658"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 5.0,5.0;" x1="1812.5" x2="1812.5" y1="229.8218" y2="7166.4658"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 5.0,5.0;" x1="2328.125" x2="2328.125" y1="229.8218" y2="7166.4658"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 5.0,5.0;" x1="3195.3125" x2="3195.3125" y1="229.8218" y2="7166.4658"/><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="262.5" x="103.125" y="119.5404"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="218.75" x="125" y="182.9865">OTADemo</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="262.5" x="103.125" y="7163.3408"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="218.75" x="125" y="7226.7868">OTADemo</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="265.625" x="932.8125" y="119.5404"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="221.875" x="954.6875" y="182.9865">OTAAgent</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="265.625" x="932.8125" y="7163.3408"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="221.875" x="954.6875" y="7226.7868">OTAAgent</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="200" x="1706.25" y="119.5404"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="156.25" x="1728.125" y="182.9865">OTAPal</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="200" x="1706.25" y="7163.3408"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="156.25" x="1728.125" y="7226.7868">OTAPal</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="171.875" x="2237.5" y="119.5404"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="128.125" x="2259.375" y="182.9865">MQTT</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="171.875" x="2237.5" y="7163.3408"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="128.125" x="2259.375" y="7226.7868">MQTT</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="206.25" x="3085.9375" y="119.5404"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="162.5" x="3107.8125" y="182.9865">AWSIoT</text><rect fill="#FEFECE" filter="url(#fytephofi9qg4)" height="94.6564" style="stroke: #A80036; stroke-width: 4.6875;" width="206.25" x="3085.9375" y="7163.3408"/><text fill="#000000" font-family="sans-serif" font-size="43.75" lengthAdjust="spacingAndGlyphs" textLength="162.5" x="3107.8125" y="7226.7868">AWSIoT</text><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="1048.4924" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="461.8622"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="278.5202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="2097.1008"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="959.8068" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="2733.0566"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="182.0404" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="4176.0895"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="182.0404" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="4587.4405"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="530.4962" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="5359.3521"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="887.9318" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="225" y="6250.4089"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="240.625" y="6796.5302"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="229.3106" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="825.943"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="495.726" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="1419.3344"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="203.5202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="2281.871"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="184.7702" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="2824.0768"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="483.226" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="3692.8635"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="756.2866" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1056.25" y="4769.4809"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="3918.6539"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="367.2058" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="4992.1463"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="6159.3887"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="109.7702" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="1796.875" y="6978.5706"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="461.8622"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="1146.2738"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="275.7904" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="1915.0604"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="184.7702" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="2733.0566"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="3175.2625"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="593.3914" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="4176.0895"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="273.0606" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="5616.7877"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="455.101" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="2314.0625" y="6250.4089"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="552.8824"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="1237.294"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="1915.0604"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="3266.2827"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="229.3106" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="4358.1299"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="5707.8079"/><rect fill="#FFFFFF" filter="url(#fytephofi9qg4)" height="91.0202" style="stroke: #A80036; stroke-width: 3.125;" width="31.25" x="3179.6875" y="6523.4695"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="9.375" style="stroke: #EEEEEE; stroke-width: 3.125;" width="3389.0625" x="9.375" y="325.3319"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="325.3319" y2="325.3319"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="334.7069" y2="334.7069"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="72.2702" style="stroke: #000000; stroke-width: 6.25;" width="318.75" x="1544.5313" y="292.3218"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="262.5" x="1563.2813" y="343.5226">Initialization</text><polygon fill="#A80036" points="2276.5625,449.3622,2307.8125,461.8622,2276.5625,474.3622,2289.0625,461.8622" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="2295.3125" y1="461.8622" y2="461.8622"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="278.125" y="447.0428">1</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="484.375" x="318.75" y="446.9437">Create MQTT connection</text><polygon fill="#A80036" points="3142.1875,540.3824,3173.4375,552.8824,3142.1875,565.3824,3154.6875,552.8824" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2345.3125" x2="3160.9375" y1="552.8824" y2="552.8824"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="2367.1875" y="538.063">2</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="375" x="2407.8125" y="537.9639">Send data to server</text><polygon fill="#A80036" points="2379.6875,631.4026,2348.4375,643.9026,2379.6875,656.4026,2367.1875,643.9026" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="2360.9375" x2="3192.1875" y1="643.9026" y2="643.9026"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="2398.4375" y="629.0833">3</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="2451.5625" y="628.9841"/><polygon fill="#A80036" points="290.625,722.4228,259.375,734.9228,290.625,747.4228,278.125,734.9228" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="271.875" x2="2326.5625" y1="734.9228" y2="734.9228"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="309.375" y="720.1035">4</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="362.5" y="720.0043"/><polygon fill="#A80036" points="1018.75,813.443,1050,825.943,1018.75,838.443,1031.25,825.943" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="1037.5" y1="825.943" y2="825.943"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="278.125" y="811.1237">5</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="381.25" x="318.75" y="811.0245">Initialize OTAAgent</text><polygon fill="#A80036" points="290.625,904.4632,259.375,916.9632,290.625,929.4632,278.125,916.9632" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="271.875" x2="1053.125" y1="916.9632" y2="916.9632"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="309.375" y="902.1439">6</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="362.5" y="902.0447"/><polygon fill="#A80036" points="290.625,1042.7536,259.375,1055.2536,290.625,1067.7536,278.125,1055.2536" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="271.875" x2="1068.75" y1="1055.2536" y2="1055.2536"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="309.375" y="1016.7992">7</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="303.125" x="350" y="993.0649">Subscibe to Job</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="343.75" x="350" y="1040.3351">&amp; Data Topics(*1)</text><polygon fill="#A80036" points="2276.5625,1133.7738,2307.8125,1146.2738,2276.5625,1158.7738,2289.0625,1146.2738" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="2295.3125" y1="1146.2738" y2="1146.2738"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="278.125" y="1131.4545">8</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="190.625" x="318.75" y="1131.3553">Subscribe</text><polygon fill="#A80036" points="3142.1875,1224.794,3173.4375,1237.294,3142.1875,1249.794,3154.6875,1237.294" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2345.3125" x2="3160.9375" y1="1237.294" y2="1237.294"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28.125" x="2367.1875" y="1222.4747">9</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="375" x="2407.8125" y="1222.3755">Send data to server</text><polygon fill="#A80036" points="2379.6875,1315.8142,2348.4375,1328.3142,2379.6875,1340.8142,2367.1875,1328.3142" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="2360.9375" x2="3192.1875" y1="1328.3142" y2="1328.3142"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2398.4375" y="1313.4949">10</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="2479.6875" y="1313.3957"/><polygon fill="#A80036" points="290.625,1406.8344,259.375,1419.3344,290.625,1431.8344,278.125,1419.3344" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="271.875" x2="2326.5625" y1="1419.3344" y2="1419.3344"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="1404.5151">11</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="390.625" y="1404.4159"/><polygon fill="#A80036" points="1018.75,1497.8546,1050,1510.3546,1018.75,1522.8546,1031.25,1510.3546" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="240.625" x2="1037.5" y1="1510.3546" y2="1510.3546"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="262.5" y="1495.5353">12</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="343.75" y="1495.4361"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="9.375" style="stroke: #EEEEEE; stroke-width: 3.125;" width="3389.0625" x="9.375" y="1599.6147"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="1599.6147" y2="1599.6147"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="1608.9897" y2="1608.9897"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="72.2702" style="stroke: #000000; stroke-width: 6.25;" width="296.875" x="1555.4688" y="1566.6046"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240.625" x="1574.2188" y="1617.8055">Job Parsing</text><line style="stroke: #A80036; stroke-width: 3.125;" x1="1087.5" x2="1218.75" y1="1783.4152" y2="1783.4152"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1218.75" x2="1218.75" y1="1783.4152" y2="1824.0402"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1090.625" x2="1218.75" y1="1824.0402" y2="1824.0402"/><polygon fill="#A80036" points="1121.875,1811.5402,1090.625,1824.0402,1121.875,1836.5402,1109.375,1824.0402" style="stroke: #A80036; stroke-width: 3.125;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1109.375" y="1744.9608">13</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="153.125" x="1178.125" y="1721.2265">Wait for</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="62.5" x="1178.125" y="1768.4967">Job</text><polygon fill="#A80036" points="2379.6875,1902.5604,2348.4375,1915.0604,2379.6875,1927.5604,2367.1875,1915.0604" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2360.9375" x2="3176.5625" y1="1915.0604" y2="1915.0604"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2398.4375" y="1900.2411">14</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="540.625" x="2467.1875" y="1900.1419">Job notification from server</text><polygon fill="#A80036" points="3157.8125,1993.5806,3189.0625,2006.0806,3157.8125,2018.5806,3170.3125,2006.0806" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="2345.3125" x2="3176.5625" y1="2006.0806" y2="2006.0806"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2367.1875" y="1991.2613">15</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="2448.4375" y="1991.1621"/><polygon fill="#A80036" points="290.625,2084.6008,259.375,2097.1008,290.625,2109.6008,278.125,2097.1008" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="271.875" x2="2310.9375" y1="2097.1008" y2="2097.1008"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="2082.2815">16</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="365.625" x="378.125" y="2082.1823">MQTT Job callback</text><polygon fill="#A80036" points="1018.75,2269.371,1050,2281.871,1018.75,2294.371,1031.25,2281.871" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="1037.5" y1="2281.871" y2="2281.871"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="2267.0517">17</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="471.875" x="346.875" y="2266.9525">Send Job Received event</text><line style="stroke: #A80036; stroke-width: 3.125;" x1="1087.5" x2="1218.75" y1="2482.2662" y2="2482.2662"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1218.75" x2="1218.75" y1="2482.2662" y2="2522.8912"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1071.875" x2="1218.75" y1="2522.8912" y2="2522.8912"/><polygon fill="#A80036" points="1103.125,2510.3912,1071.875,2522.8912,1103.125,2535.3912,1090.625,2522.8912" style="stroke: #A80036; stroke-width: 3.125;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1109.375" y="2467.4469">18</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="596.875" x="1178.125" y="2467.3477">Parse Job Document (json) (*2)</text><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="9.375" style="stroke: #EEEEEE; stroke-width: 3.125;" width="3389.0625" x="9.375" y="2596.5263"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="2596.5263" y2="2596.5263"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="2605.9013" y2="2605.9013"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="72.2702" style="stroke: #000000; stroke-width: 6.25;" width="584.375" x="1411.7188" y="2563.5162"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="528.125" x="1430.4688" y="2614.7171">Connection Management</text><polygon fill="#A80036" points="290.625,2720.5566,259.375,2733.0566,290.625,2745.5566,278.125,2733.0566" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="271.875" x2="2310.9375" y1="2733.0566" y2="2733.0566"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="2718.2373">19</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="531.25" x="378.125" y="2718.1381">MQTT Disconnect Callback</text><polygon fill="#A80036" points="1018.75,2811.5768,1050,2824.0768,1018.75,2836.5768,1031.25,2824.0768" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="1037.5" y1="2824.0768" y2="2824.0768"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="2809.2575">20</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="262.5" x="346.875" y="2809.1583">Suspend OTA</text><polygon fill="#A80036" points="290.625,2996.347,259.375,3008.847,290.625,3021.347,278.125,3008.847" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="271.875" x2="1068.75" y1="3008.847" y2="3008.847"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="2994.0277">21</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="390.625" y="2993.9285"/><path d="M71.875,3055.722 L303.125,3055.722 L303.125,3077.597 L271.875,3108.847 L71.875,3108.847 L71.875,3055.722 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 3.125;"/><rect fill="none" height="549.2462" style="stroke: #000000; stroke-width: 6.25;" width="3264.0625" x="71.875" y="3055.722"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90.625" x="118.75" y="3097.5479">loop</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="690.625" x="350" y="3094.7189">[till connection succeed or max retries]</text><polygon fill="#A80036" points="2276.5625,3162.7625,2307.8125,3175.2625,2276.5625,3187.7625,2289.0625,3175.2625" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="2295.3125" y1="3175.2625" y2="3175.2625"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="3160.4431">22</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="356.25" x="346.875" y="3160.3439">Re-connect MQTT</text><polygon fill="#A80036" points="3142.1875,3253.7827,3173.4375,3266.2827,3142.1875,3278.7827,3154.6875,3266.2827" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2345.3125" x2="3160.9375" y1="3266.2827" y2="3266.2827"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2367.1875" y="3251.4633">23</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="375" x="2435.9375" y="3251.3641">Send data to server</text><polygon fill="#A80036" points="2379.6875,3344.8029,2348.4375,3357.3029,2379.6875,3369.8029,2367.1875,3357.3029" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="2360.9375" x2="3192.1875" y1="3357.3029" y2="3357.3029"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2398.4375" y="3342.4835">24</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="2479.6875" y="3342.3843"/><polygon fill="#A80036" points="290.625,3435.8231,259.375,3448.3231,290.625,3460.8231,278.125,3448.3231" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="271.875" x2="2326.5625" y1="3448.3231" y2="3448.3231"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="3433.5037">25</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="162.5" x="378.125" y="3433.4045">Timeout</text><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="387.5" y1="3554.9683" y2="3554.9683"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="387.5" x2="387.5" y1="3554.9683" y2="3595.5933"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="240.625" x2="387.5" y1="3595.5933" y2="3595.5933"/><polygon fill="#A80036" points="271.875,3583.0933,240.625,3595.5933,271.875,3608.0933,259.375,3595.5933" style="stroke: #A80036; stroke-width: 3.125;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="3540.1489">26</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="687.5" x="346.875" y="3540.0497">Exponential Delay( multiplied by 2)</text><polygon fill="#A80036" points="1018.75,3680.3635,1050,3692.8635,1018.75,3705.3635,1031.25,3692.8635" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="240.625" x2="1037.5" y1="3692.8635" y2="3692.8635"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="262.5" y="3678.0441">27</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="378.125" x="331.25" y="3677.9449">Resume OTA Agent</text><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="9.375" style="stroke: #EEEEEE; stroke-width: 3.125;" width="3389.0625" x="9.375" y="3782.1236"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="3782.1236" y2="3782.1236"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="3791.4986" y2="3791.4986"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="72.2702" style="stroke: #000000; stroke-width: 6.25;" width="350" x="1528.9063" y="3749.1135"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="293.75" x="1547.6563" y="3800.3143">File Download</text><polygon fill="#A80036" points="1759.375,3906.1539,1790.625,3918.6539,1759.375,3931.1539,1771.875,3918.6539" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1087.5" x2="1778.125" y1="3918.6539" y2="3918.6539"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1109.375" y="3903.8345">28</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="478.125" x="1178.125" y="3903.7354">Create File for download</text><polygon fill="#A80036" points="1121.875,3997.1741,1090.625,4009.6741,1121.875,4022.1741,1109.375,4009.6741" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="1103.125" x2="1809.375" y1="4009.6741" y2="4009.6741"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1140.625" y="3994.8547">29</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="1221.875" y="3994.7556"/><path d="M40.625,4056.5491 L271.875,4056.5491 L271.875,4078.4241 L240.625,4109.6741 L40.625,4109.6741 L40.625,4056.5491 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 3.125;"/><rect fill="none" height="1880.1743" style="stroke: #000000; stroke-width: 6.25;" width="3326.5625" x="40.625" y="4056.5491"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90.625" x="87.5" y="4098.3749">loop</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="556.25" x="318.75" y="4095.546">[Till file download is complete]</text><polygon fill="#A80036" points="290.625,4163.5895,259.375,4176.0895,290.625,4188.5895,278.125,4176.0895" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="271.875" x2="1068.75" y1="4176.0895" y2="4176.0895"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="4161.2701">30</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="587.5" x="378.125" y="4161.171">Request File blocks (cbor) (*3)</text><polygon fill="#A80036" points="2276.5625,4254.6097,2307.8125,4267.1097,2276.5625,4279.6097,2289.0625,4267.1097" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="2295.3125" y1="4267.1097" y2="4267.1097"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="4252.2903">31</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="146.875" x="346.875" y="4252.1912">publish</text><polygon fill="#A80036" points="3142.1875,4345.6299,3173.4375,4358.1299,3142.1875,4370.6299,3154.6875,4358.1299" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2345.3125" x2="3160.9375" y1="4358.1299" y2="4358.1299"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2367.1875" y="4343.3105">32</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="375" x="2435.9375" y="4343.2114">Send data to server</text><polygon fill="#A80036" points="2379.6875,4436.6501,2348.4375,4449.1501,2379.6875,4461.6501,2367.1875,4449.1501" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="2360.9375" x2="3176.5625" y1="4449.1501" y2="4449.1501"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2398.4375" y="4434.3307">33</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="2479.6875" y="4434.2316"/><polygon fill="#A80036" points="2379.6875,4574.9405,2348.4375,4587.4405,2379.6875,4599.9405,2367.1875,4587.4405" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2360.9375" x2="3192.1875" y1="4587.4405" y2="4587.4405"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2398.4375" y="4548.9861">34</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="350" x="2467.1875" y="4525.2518">Packet containing</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="206.25" x="2467.1875" y="4572.522">file blocks</text><polygon fill="#A80036" points="290.625,4665.9607,259.375,4678.4607,290.625,4690.9607,278.125,4678.4607" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="271.875" x2="2310.9375" y1="4678.4607" y2="4678.4607"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="4663.6414">35</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="393.75" x="378.125" y="4663.5422">MQTT Data callback</text><polygon fill="#A80036" points="1018.75,4756.9809,1050,4769.4809,1018.75,4781.9809,1031.25,4769.4809" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="240.625" x2="1037.5" y1="4769.4809" y2="4769.4809"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="262.5" y="4754.6616">36</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="346.875" x="331.25" y="4754.5624">Process file block</text><line style="stroke: #A80036; stroke-width: 3.125;" x1="1087.5" x2="1218.75" y1="4860.5011" y2="4860.5011"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1218.75" x2="1218.75" y1="4860.5011" y2="4901.1261"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1090.625" x2="1218.75" y1="4901.1261" y2="4901.1261"/><polygon fill="#A80036" points="1121.875,4888.6261,1090.625,4901.1261,1121.875,4913.6261,1109.375,4901.1261" style="stroke: #A80036; stroke-width: 3.125;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1109.375" y="4845.6818">37</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="575" x="1178.125" y="4845.5826">Decode File Blocks (cbor) (*4)</text><polygon fill="#A80036" points="1759.375,4979.6463,1790.625,4992.1463,1759.375,5004.6463,1771.875,4992.1463" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1087.5" x2="1778.125" y1="4992.1463" y2="4992.1463"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1109.375" y="4977.327">38</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="321.875" x="1178.125" y="4977.2278">Write File Blocks</text><path d="M1675,5039.0213 L1868.75,5039.0213 L1868.75,5060.8963 L1837.5,5092.1463 L1675,5092.1463 L1675,5039.0213 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 3.125;"/><rect fill="none" height="232.4356" style="stroke: #000000; stroke-width: 6.25;" width="565.625" x="1675" y="5039.0213"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53.125" x="1721.875" y="5080.8472">alt</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="309.375" x="1915.625" y="5078.0182">[If last file block]</text><line style="stroke: #A80036; stroke-width: 3.125;" x1="1828.125" x2="1959.375" y1="5205.8319" y2="5205.8319"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1959.375" x2="1959.375" y1="5205.8319" y2="5246.4569"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1831.25" x2="1959.375" y1="5246.4569" y2="5246.4569"/><polygon fill="#A80036" points="1862.5,5233.9569,1831.25,5246.4569,1862.5,5258.9569,1850,5246.4569" style="stroke: #A80036; stroke-width: 3.125;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1850" y="5167.3775">39</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="237.5" x="1918.75" y="5143.6432">Verify cypto</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="184.375" x="1918.75" y="5190.9134">signature</text><polygon fill="#A80036" points="1121.875,5346.8521,1090.625,5359.3521,1121.875,5371.8521,1109.375,5359.3521" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="1103.125" x2="1809.375" y1="5359.3521" y2="5359.3521"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1140.625" y="5344.5328">40</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="1221.875" y="5344.4336"/><path d="M71.875,5406.2271 L265.625,5406.2271 L265.625,5428.1021 L234.375,5459.3521 L71.875,5459.3521 L71.875,5406.2271 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 3.125;"/><rect fill="none" height="508.6212" style="stroke: #000000; stroke-width: 6.25;" width="3264.0625" x="71.875" y="5406.2271"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53.125" x="118.75" y="5448.053">alt</text><text fill="#000000" font-family="sans-serif" font-size="34.375" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="684.375" x="312.5" y="5445.224">[Every 64(default) file blocks received]</text><polygon fill="#A80036" points="290.625,5513.2675,259.375,5525.7675,290.625,5538.2675,278.125,5525.7675" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="271.875" x2="1068.75" y1="5525.7675" y2="5525.7675"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="5510.9482">41</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="212.5" x="378.125" y="5510.849">Update Job</text><polygon fill="#A80036" points="2276.5625,5604.2877,2307.8125,5616.7877,2276.5625,5629.2877,2289.0625,5616.7877" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="2295.3125" y1="5616.7877" y2="5616.7877"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="5601.9684">42</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="143.75" x="346.875" y="5601.8692">Publish</text><polygon fill="#A80036" points="3142.1875,5695.3079,3173.4375,5707.8079,3142.1875,5720.3079,3154.6875,5707.8079" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2345.3125" x2="3160.9375" y1="5707.8079" y2="5707.8079"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2367.1875" y="5692.9886">43</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="375" x="2435.9375" y="5692.8894">Send data to server</text><polygon fill="#A80036" points="2379.6875,5786.3281,2348.4375,5798.8281,2379.6875,5811.3281,2367.1875,5798.8281" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="2360.9375" x2="3192.1875" y1="5798.8281" y2="5798.8281"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2398.4375" y="5784.0088">44</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="2479.6875" y="5783.9096"/><polygon fill="#A80036" points="275,5877.3483,243.75,5889.8483,275,5902.3483,262.5,5889.8483" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="256.25" x2="2326.5625" y1="5889.8483" y2="5889.8483"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="293.75" y="5875.029">45</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="375" y="5874.9298"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="9.375" style="stroke: #EEEEEE; stroke-width: 3.125;" width="3389.0625" x="9.375" y="6022.8584"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="6022.8584" y2="6022.8584"/><line style="stroke: #000000; stroke-width: 3.125;" x1="9.375" x2="3398.4375" y1="6032.2334" y2="6032.2334"/><rect fill="#EEEEEE" filter="url(#fytephofi9qg4)" height="72.2702" style="stroke: #000000; stroke-width: 6.25;" width="415.625" x="1496.0938" y="5989.8483"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="359.375" x="1514.8438" y="6041.0492">Activating Image</text><polygon fill="#A80036" points="1759.375,6146.8887,1790.625,6159.3887,1759.375,6171.8887,1771.875,6159.3887" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1071.875" x2="1778.125" y1="6159.3887" y2="6159.3887"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1093.75" y="6144.5694">46</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="271.875" x="1162.5" y="6144.4702">Set boot flags</text><polygon fill="#A80036" points="1106.25,6237.9089,1075,6250.4089,1106.25,6262.9089,1093.75,6250.4089" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="1087.5" x2="1809.375" y1="6250.4089" y2="6250.4089"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1125" y="6235.5896">47</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="1206.25" y="6235.4904"/><polygon fill="#A80036" points="290.625,6328.9291,259.375,6341.4291,290.625,6353.9291,278.125,6341.4291" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="271.875" x2="1068.75" y1="6341.4291" y2="6341.4291"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="6326.6098">48</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="346.875" x="378.125" y="6326.5106">Update Job status</text><polygon fill="#A80036" points="2276.5625,6419.9493,2307.8125,6432.4493,2276.5625,6444.9493,2289.0625,6432.4493" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="256.25" x2="2295.3125" y1="6432.4493" y2="6432.4493"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="6417.63">49</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="143.75" x="346.875" y="6417.5308">Publish</text><polygon fill="#A80036" points="3142.1875,6510.9695,3173.4375,6523.4695,3142.1875,6535.9695,3154.6875,6523.4695" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="2345.3125" x2="3160.9375" y1="6523.4695" y2="6523.4695"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2367.1875" y="6508.6502">50</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="375" x="2435.9375" y="6508.551">Send data to server</text><polygon fill="#A80036" points="2379.6875,6601.9897,2348.4375,6614.4897,2379.6875,6626.9897,2367.1875,6614.4897" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="2360.9375" x2="3192.1875" y1="6614.4897" y2="6614.4897"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="2398.4375" y="6599.6704">51</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="2479.6875" y="6599.5712"/><polygon fill="#A80036" points="290.625,6693.0099,259.375,6705.5099,290.625,6718.0099,278.125,6705.5099" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="271.875" x2="2326.5625" y1="6705.5099" y2="6705.5099"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="309.375" y="6690.6906">52</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="390.625" y="6690.5914"/><polygon fill="#A80036" points="306.25,6784.0302,275,6796.5302,306.25,6809.0302,293.75,6796.5302" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="287.5" x2="1068.75" y1="6796.5302" y2="6796.5302"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="325" y="6781.7108">53</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="443.75" x="393.75" y="6781.6116">Callback for activation</text><polygon fill="#A80036" points="1034.375,6875.0504,1065.625,6887.5504,1034.375,6900.0504,1046.875,6887.5504" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125; stroke-dasharray: 2.0,2.0;" x1="256.25" x2="1053.125" y1="6887.5504" y2="6887.5504"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="278.125" y="6872.731">54</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="0" x="359.375" y="6872.6318"/><polygon fill="#A80036" points="1759.375,6966.0706,1790.625,6978.5706,1759.375,6991.0706,1771.875,6978.5706" style="stroke: #A80036; stroke-width: 3.125;"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1071.875" x2="1778.125" y1="6978.5706" y2="6978.5706"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1093.75" y="6963.7512">55</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="290.625" x="1162.5" y="6963.652">Activate Image</text><line style="stroke: #A80036; stroke-width: 3.125;" x1="1828.125" x2="1959.375" y1="7085.2158" y2="7085.2158"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1959.375" x2="1959.375" y1="7085.2158" y2="7125.8408"/><line style="stroke: #A80036; stroke-width: 3.125;" x1="1812.5" x2="1959.375" y1="7125.8408" y2="7125.8408"/><polygon fill="#A80036" points="1843.75,7113.3408,1812.5,7125.8408,1843.75,7138.3408,1831.25,7125.8408" style="stroke: #A80036; stroke-width: 3.125;"/><text fill="#000000" font-family="sans-serif" font-size="40.625" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="1850" y="7070.3964">56</text><text fill="#000000" font-family="sans-serif" font-size="40.625" lengthAdjust="spacingAndGlyphs" textLength="106.25" x="1918.75" y="7070.2972">Reset</text><!--MD5=[6235ba6202f58721b4e90c5f77abfc4e]
@startuml
skinparam dpi 300
skinparam classFontSize 8
skinparam classFontName Helvetica
autonumber

box "Application" #Mistyrose
participant OTADemo
end box
box "OTA Library" #LightGreen
participant OTAAgent
participant OTAPal
end box
box "Connectivity Libraries" #LightBlue
participant MQTT
end box
box "Cloud AWS IoT \nService" #Darksalmon
participant AWSIoT

== Initialization ==
OTADemo -> MQTT : Create MQTT connection
activate OTADemo
activate MQTT
MQTT -> AWSIoT : Send data to server
activate AWSIoT
MQTT <- - AWSIoT
deactivate AWSIoT
OTADemo <- - MQTT
deactivate MQTT

OTADemo -> OTAAgent :Initialize OTAAgent
activate OTAAgent
OTADemo <- - OTAAgent

OTAAgent -> OTADemo : Subscibe to Job\n& Data Topics(*1)
deactivate OTAAgent
OTADemo -> MQTT : Subscribe
activate MQTT
MQTT -> AWSIoT : Send data to server
activate AWSIoT
MQTT <- - AWSIoT
deactivate AWSIoT
OTADemo <- - MQTT
deactivate 
activate OTAAgent
OTADemo - -> OTAAgent
deactivate OTADemo

== Job Parsing ==
OTAAgent -> OTAAgent : Wait for \nJob
MQTT <- AWSIoT : Job notification from server
deactivate OTAAgent
activate AWSIoT
activate MQTT
MQTT - -> AWSIoT
deactivate AWSIoT

MQTT -> OTADemo : MQTT Job callback
activate OTADemo
deactivate MQTT
OTADemo -> OTAAgent : Send Job Received event
activate OTAAgent 
deactivate OTADemo
OTAAgent -> OTAAgent : Parse Job Document (json) (*2)
deactivate OTAAgent
== Connection Management ==

MQTT -> OTADemo : MQTT Disconnect Callback

activate MQTT

activate OTADemo
OTADemo -> OTAAgent : Suspend OTA 
activate OTAAgent
deactivate MQTT
OTAAgent - -> OTADemo
deactivate OTAAgent

loop till connection succeed or max retries

OTADemo -> MQTT : Re-connect MQTT
activate MQTT
MQTT -> AWSIoT : Send data to server
activate AWSIoT
MQTT <- - AWSIoT
deactivate AWSIoT
OTADemo <- - MQTT : Timeout
deactivate MQTT

OTADemo -> OTADemo : Exponential Delay( multiplied by 2)
deactivate MQTT
end
OTADemo -> OTAAgent : Resume OTA Agent
deactivate OTADemo
activate OTAAgent

== File Download ==

OTAAgent -> OTAPal : Create File for download
activate OTAPal
OTAAgent <- - OTAPal
deactivate OTAPal
loop Till file download is complete
OTAAgent -> OTADemo : Request File blocks (cbor) (*3)
deactivate OTAAgent
activate OTADemo
activate MQTT
OTADemo -> MQTT : publish
MQTT -> AWSIoT : Send data to server
deactivate OTADemo
activate AWSIoT
MQTT <- - AWSIoT
MQTT <- AWSIoT :  Packet containing\nfile blocks 
deactivate AWSIoT
activate OTADemo
MQTT -> OTADemo : MQTT Data callback

OTADemo -> OTAAgent : Process file block
deactivate MQTT
deactivate OTADemo
activate OTAAgent

OTAAgent -> OTAAgent : Decode File Blocks (cbor) (*4)
OTAAgent -> OTAPal : Write File Blocks
activate OTAPal

alt If last file block
OTAPal -> OTAPal : Verify cypto\nsignature
end
OTAAgent <- - OTAPal 
deactivate OTAPal


alt Every 64(default) file blocks received
activate OTADemo
OTAAgent -> OTADemo : Update Job 
deactivate OTAAgent
OTADemo -> MQTT : Publish

activate MQTT
MQTT -> AWSIoT : Send data to server
activate AWSIoT
MQTT <- - AWSIoT
deactivate AWSIoT
MQTT - -> OTADemo
deactivate MQTT
deactivate OTADemo
end
end
activate OTAAgent
== Activating Image ==

OTAAgent -> OTAPal : Set boot flags
activate OTAPal
OTAAgent <- - OTAPal
deactivate OTAPal
deactivate OTAAgent
activate OTADemo
activate MQTT
OTAAgent -> OTADemo : Update Job status
OTADemo -> MQTT : Publish

MQTT -> AWSIoT : Send data to server
activate AWSIoT
MQTT <- - AWSIoT
deactivate AWSIoT
MQTT - -> OTADemo
deactivate MQTT

OTAAgent -> OTADemo : Callback for activation
activate OTADemo
OTADemo - -> OTAAgent
deactivate OTADemo

OTAAgent -> OTAPal : Activate Image
deactivate OTAAgent
activate OTAPal
OTAPal -> OTAPal :Reset 
deactivate OTAPal
deactivate OTAAgent
@enduml

PlantUML version 1.2020.15(Sun Jun 28 11:39:45 UTC 2020)
(GPLV2 source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>